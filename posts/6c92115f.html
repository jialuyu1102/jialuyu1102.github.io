<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Spring | JLY的小窝</title><meta name="author" content="JLY"><meta name="copyright" content="JLY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Spring">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring">
<meta property="og:url" content="http://example.com/posts/6c92115f.html">
<meta property="og:site_name" content="JLY的小窝">
<meta property="og:description" content="Spring">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/51f1d6a7e90c510ac74f0089bcd6c805.png">
<meta property="article:published_time" content="2024-08-19T15:26:37.000Z">
<meta property="article:modified_time" content="2024-08-19T23:55:49.181Z">
<meta property="article:author" content="JLY">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="IOC">
<meta property="article:tag" content="DI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/51f1d6a7e90c510ac74f0089bcd6c805.png"><link rel="shortcut icon" href="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/%E5%9B%BE%E6%A0%87.png"><link rel="canonical" href="http://example.com/posts/6c92115f.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"JY2YQT4F25","apiKey":"2fbf3647b8c7f04346c64c9ede0a0124","indexName":"hexo_blog","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"最后一次更新为","messageNext":"天前,文章内容可能已过期."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: JLY","link":"链接: ","source":"来源: JLY的小窝","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-20 07:55:49'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/config/css/style.css?1"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="JLY的小窝" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/%E5%A4%B4%E5%83%8F.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">40</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/51f1d6a7e90c510ac74f0089bcd6c805.png')"><nav id="nav"><span id="blog-info"><a href="/" title="JLY的小窝"><span class="site-name">JLY的小窝</span></a></span><div id="menus"></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="nav-right"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><!-- span=' '+_p('search.title')--></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Spring</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-19T15:26:37.000Z" title="发表于 2024-08-19 23:26:37">2024-08-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-19T23:55:49.181Z" title="更新于 2024-08-20 07:55:49">2024-08-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java%E6%8A%80%E6%9C%AF%E6%A0%88/">Java技术栈</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">15.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>63分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Spring"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><!-- if is_home()// #home_top--><main class="layout" id="content-inner"><div id="post"><div class="top-img gist" style="background-image: url(https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/51f1d6a7e90c510ac74f0089bcd6c805.png)"></div><article class="post-content" id="article-container"><h1 id="传统Javaweb开发的困惑"><a href="#传统Javaweb开发的困惑" class="headerlink" title="传统Javaweb开发的困惑"></a>传统Javaweb开发的困惑</h1><p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818114232664.png" alt="image-20240818114232664"></p>
<ul>
<li>困惑一</li>
</ul>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818114317117.png" alt="image-20240818114317117"></p>
<blockquote>
<p>结合思路：</p>
<p>程序代码中不要手动new对象，第 三方根据要求为程序提供需要的Bean对象</p>
</blockquote>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818114855503.png" alt="image-20240818114855503"></p>
<ul>
<li>困惑2</li>
</ul>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818114328435.png" alt="image-20240818114328435"></p>
<blockquote>
<p>解决思路：</p>
<p>程序代码中不要手动new对象，第三方根据 要求为程序提供需要的Bean对象的代理对象，代理对象 内部动态结合业务和通用功能</p>
</blockquote>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818114917786.png" alt="image-20240818114917786"></p>
<h1 id="IOC、DI、AOP思想提出"><a href="#IOC、DI、AOP思想提出" class="headerlink" title="IOC、DI、AOP思想提出"></a>IOC、DI、AOP思想提出</h1><h2 id="IOC、DI思想提出"><a href="#IOC、DI思想提出" class="headerlink" title="IOC、DI思想提出"></a>IOC、DI思想提出</h2><p>实际开发中，对象之间的耦合关系，就类似手表内部的齿轮，每个齿轮都紧密啮合在一起，一旦某个齿轮发生故障，那么整个系统也意味着崩溃。尽可能让对象之间的关系保持松耦合状态是我们期望的。</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818115133928.png" alt="image-20240818115133928"></p>
<p>IoC思想： Inversion of Control，翻译为“控制反转”或“反转控制”，强调的是原来在程序中创建Bean的权利反 转给第三方。</p>
<blockquote>
<p>例如：原来在程序中手动的去 new UserServiceImpl()，手动的去new UserDaoImpl()，而根据IoC思想的指导， 寻求一个第三方去创建UserServiceImpl对象和UserDaoImpl对象。这样程序与具体对象就失去的直接联系。</p>
</blockquote>
<p>谁去充当第三方角色呢？</p>
<p>​        工厂设计模式，BeanFactory来充当第三方的角色，来产生Bean实例</p>
<p>BeanFactory怎么知道产生哪些Bean实例呢？</p>
<p>​        可以使用配置文件配置Bean的基本信息，BeanFactory根据配置文件来生产Bean实例</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818115312763.png" alt="image-20240818115312763"></p>
<p>例如，用IoC思想去反转UserServiceImpl的创建权，由原来程序中创建反转给通过BeanFactory去创建</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818115350148.png" alt="image-20240818115350148"></p>
<p>上面使用BeanFactory的方式已经实现的”控制反转”，将Bean的创建权交给了BeanFactory，如果我们想将 UserDao的创建权也反转给BeanFactory，与此同时UserService内部还需要用到UserDao实例对象，那应该怎 样操作呢？</p>
<ul>
<li>在程序中，通过BeanFactory获得UserService</li>
<li>在程序中，通过BeanFactory获得UserDao</li>
<li>在程序中，将UserDao设置给UserService</li>
</ul>
<p>该方式是否存在一些问题？</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818115621290.png" alt="image-20240818115621290"></p>
<p>UserService存在于BeanFactory中， UserDao也存在于BeanFactory中， 可以在BeanFactory内部进行结合</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818115752599.png" alt="image-20240818115752599"></p>
<p>将UserDao在BeanFactory内部设置 给UserService的过程叫做<code>注入</code>，而UserService需要依赖UserDao 的注入才能正常工作，这个过程叫做 <code>依赖注入</code></p>
<blockquote>
<p>面试题：IoC 和 DI 的关系？</p>
<p>首先，先回答IoC和DI的是什么：</p>
<p>​     IoC： Inversion of Control，控制反转，将Bean的创建权由原来程序反转给第三方</p>
<p>​     DI：Dependency Injection，依赖注入，某个Bean的完整创建依赖于其他Bean（或普通参数）的注入</p>
<p>其次，在回答IoC和DI的关系：</p>
<p>​     第一种观点：IoC强调的是Bean创建权的反转，而DI强调的是Bean的依赖关系，认为不是一回事</p>
<p>​    第二种观点：IoC强调的是Bean创建权的反转，而DI强调的是通过注入的方式反转Bean的创建权，认为DI 是IoC的其中一种实现方式</p>
</blockquote>
<h2 id="AOP-面向切面思想提出"><a href="#AOP-面向切面思想提出" class="headerlink" title="AOP 面向切面思想提出"></a>AOP 面向切面思想提出</h2><p>IoC和DI思想主要是解决前面我们的困惑一，困惑二还没有解决</p>
<p>困惑二的解决方案是，借助于IoC思想，将Bean的创建权反转给BeanFactory，而BeanFactory生产的Bean是 目标Bean的代理对象，这样就可以在代理对象中对目标对象方法进行相应的增强。</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818130526692.png" alt="image-20240818130526692"></p>
<p>AOP，Aspect Oriented Programming，面向切面编程，是对面向对象编程OOP的升华。OOP是纵向对一个 事物的抽象，一个对象包括静态的属性信息，包括动态的方法信息等。而AOP是横向的对不同事物的抽象，属 性与属性、方法与方法、对象与对象都可以组成一个切面，而用这种思维去设计编程的方式叫做面向切面编程</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818130550449.png" alt="image-20240818130550449"></p>
<p>三种思想总结</p>
<ul>
<li>IoC控制反转，是将程序创建Bean的权利反转给第三方；</li>
<li>DI依赖注入，某个完整Bean需要依赖于其他Bean（或属性）的注入；</li>
<li>AOP面向切面编程，用横向抽取方法（属性、对象等）思想，组装成一个功能性切面。</li>
</ul>
<h1 id="Spring框架的诞生"><a href="#Spring框架的诞生" class="headerlink" title="Spring框架的诞生"></a>Spring框架的诞生</h1><h2 id="Spring-框架概述"><a href="#Spring-框架概述" class="headerlink" title="Spring 框架概述"></a>Spring 框架概述</h2><p>spring是一个开源的轻量级Java开发应用框架，可以简化企业级应用开发。Spring解决了开发者在JavaEE开发 中遇到的许多常见的问题，提供了功能强大IOC、AOP及Web MVC等功能。是当前企业中Java开发几乎不能 缺少的框架之一。Spring的生态及其完善，不管是Spring哪个领域的解决方案都是依附于在Spring  Framework基础框架的。</p>
<p>Spring的官网：www.spring.io</p>
<h2 id="Spring-框架的历史"><a href="#Spring-框架的历史" class="headerlink" title="Spring 框架的历史"></a>Spring 框架的历史</h2><ul>
<li>Jsp 默默扛下所有；</li>
<li>MVC+三层架构分工明确，但开发成本及其高；</li>
<li>EJB 重量级框架出现，走出一个困境，有进入另一个困境；</li>
<li>Spring 春天来到，随之，SSH风生水起、称霸武林；</li>
<li>Spring 稳住江湖大哥位置，SSM开始上位；</li>
<li>Spring 本着“拿来主义”的思维快速发展，生态不断健全；</li>
<li>SpringBoot 又一里程碑崛起，把“约定大于配置“思想玩儿的炉火纯青；</li>
<li>SpringCloud 打包了微服务众多解决方案，应对互联网项目更加easy！</li>
</ul>
<h2 id="Spring-Framework技术栈"><a href="#Spring-Framework技术栈" class="headerlink" title="Spring Framework技术栈"></a>Spring Framework技术栈</h2><p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818130933441.png" alt="image-20240818130933441"></p>
<h1 id="BeanFactory-快速入门"><a href="#BeanFactory-快速入门" class="headerlink" title="BeanFactory 快速入门"></a>BeanFactory 快速入门</h1><p>根据下图，分析一下Spring的BeanFactory的开发步骤：</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818131015347.png" alt="image-20240818131015347"></p>
<ul>
<li>导入Spring的jar包或Maven坐标；</li>
<li>定义UserService接口及其UserServiceImpl实现类；</li>
<li>创建beans.xml配置文件，将UserServiceImpl的信息配置到该xml中；</li>
<li>编写测试代码，创建BeanFactory，加载配置文件，获取UserService实例对象。</li>
</ul>
<h2 id="BeanFactory-快速入门-1"><a href="#BeanFactory-快速入门-1" class="headerlink" title="BeanFactory 快速入门"></a>BeanFactory 快速入门</h2><h3 id="导入Spring依赖"><a href="#导入Spring依赖" class="headerlink" title="导入Spring依赖"></a>导入Spring依赖</h3><ol>
<li>导入Spring的jar包或Maven坐标</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--Spring核心--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;<span class="number">5.3</span><span class="number">.7</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h3 id="实现IOC"><a href="#实现IOC" class="headerlink" title="实现IOC"></a>实现IOC</h3><ol>
<li>定义UserService接口及其UserServiceImpl实现类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>创建beans.xml配置文件，将UserServiceImpl的信息配置到该xml中</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>编写测试代码，创建BeanFactory，加载配置文件，获取UserService实例对象</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建BeanFactory</span></span><br><span class="line"><span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line"><span class="comment">//创建读取器</span></span><br><span class="line"><span class="type">XmlBeanDefinitionReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(beanFactory);</span><br><span class="line"><span class="comment">//加载配置文件</span></span><br><span class="line">reader.loadBeanDefinitions(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line"><span class="comment">//获取Bean实例对象</span></span><br><span class="line"><span class="type">UserDao</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) beanFactory.getBean(<span class="string">&quot;userService&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>上面使用BeanFactory完成了IoC思想的实现，下面去实现以下DI依赖注入：</p>
<ul>
<li>定义UserDao接口及其UserDaoImpl实现类；</li>
<li>修改UserServiceImpl代码，添加一个setUserDao(UserDao userDao)用于接收注入的对象；</li>
<li>修改beans.xml配置文件，在UserDaoImpl的中嵌入配置注入；</li>
<li>修改测试代码，获得UserService时，setUserService方法执行了注入操作。</li>
</ul>
<h3 id="实现DI"><a href="#实现DI" class="headerlink" title="实现DI"></a>实现DI</h3><ol>
<li>定义UserDao接口及其UserDaoImpl实现类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>修改UserServiceImpl代码，添加一个setUserDao(UserDao userDao)用于接收注入的对象</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">		System.out.println(userDao);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>定义UserDao接口及其UserDaoImpl实现类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">	&lt;property name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>编写测试代码，创建BeanFactory，加载配置文件，获取UserService实例对象</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建BeanFactory</span></span><br><span class="line"><span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line"><span class="comment">//创建读取器</span></span><br><span class="line"><span class="type">XmlBeanDefinitionReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(beanFactory);</span><br><span class="line"><span class="comment">//加载配置文件</span></span><br><span class="line">reader.loadBeanDefinitions(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line"><span class="comment">//获取Bean实例对象</span></span><br><span class="line"><span class="type">UserDao</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) beanFactory.getBean(<span class="string">&quot;userService&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="ApplicationContext快速入门"><a href="#ApplicationContext快速入门" class="headerlink" title="ApplicationContext快速入门"></a>ApplicationContext快速入门</h2><p>ApplicationContext 称为Spring容器，内部封装了BeanFactory，比BeanFactory功能更丰富更强大，使用 ApplicationContext 进行开发时，xml配置文件的名称习惯写成applicationContext.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建ApplicationContext,加载配置文件，实例化容器</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathxmlApplicationContext</span>(“applicationContext.xml<span class="string">&quot;);</span></span><br><span class="line"><span class="string">//根据beanName获得容器中的Bean实例</span></span><br><span class="line"><span class="string">UserService userService = (UserService) applicationContext.getBean(&quot;</span>userService<span class="string">&quot;);</span></span><br><span class="line"><span class="string">System.out.println(userService);</span></span><br></pre></td></tr></table></figure>
<h2 id="BeanFactory与ApplicationContext的关系"><a href="#BeanFactory与ApplicationContext的关系" class="headerlink" title="BeanFactory与ApplicationContext的关系"></a>BeanFactory与ApplicationContext的关系</h2><p>ApplicationContext除了继承了BeanFactory外，还继承了ApplicationEventPublisher（事件发布器）、 ResouresPatternResolver（资源解析器）、MessageSource（消息资源）等。但是ApplicationContext的核心功 能还是BeanFactory。</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818132041841.png" alt="image-20240818132041841"></p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818132055926.png" alt="image-20240818132055926"></p>
<p>applicationContext内部维护着beanFactory的引用，在学习过程中会查看beanFactory内部维护的属性，断点查 看如下图示内容的</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818132129907.png" alt="image-20240818132129907"></p>
<p>验证BeanFactory和ApplicationContext对Bean的初始化时机，在UserDaoImpl的无参构造内打印一句话，验证 构造方法的执行时机</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">()</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;UserDaoImpl创建了...&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>断点观察，BeanFactory方式时，当调用getBean方法时才会把需要的Bean实例创建，即延迟加载；而 ApplicationContext是加载配置文件，容器创建时就将所有的Bean实例都创建好了，存储到一个单例池中，当调 用getBean时直接从单例池中获取Bean实例返回</p>
<h2 id="BeanFactory的继承体系"><a href="#BeanFactory的继承体系" class="headerlink" title="BeanFactory的继承体系"></a>BeanFactory的继承体系</h2><p>BeanFactory是核心接口，项目运行过程中肯定有具体实现参与，这个具体实现就是DefaultListableBeanFactory ，而ApplicationContext内部维护的Beanfactory的实现类也是它</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818132306836.png" alt="image-20240818132306836"></p>
<h2 id="ApplicationContext的继承体系"><a href="#ApplicationContext的继承体系" class="headerlink" title="ApplicationContext的继承体系"></a>ApplicationContext的继承体系</h2><p>只在Spring基础环境下，即只导入spring-context坐标时，此时ApplicationContext的继承体系</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>实现类</th>
<th>功能描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>ClassPathXmlApplicationContext</td>
<td>加载类路径下的xml配置的ApplicationContext</td>
</tr>
<tr>
<td>FileSystemXmlApplicationContext</td>
<td>加载磁盘路径下的xml配置的ApplicationContext</td>
</tr>
<tr>
<td>AnnotationConfigApplicationContext</td>
<td>加载注解配置类的ApplicationContext</td>
</tr>
</tbody>
</table>
</div>
<p>如果Spring基础环境中加入了其他组件解决方案，如web层解决方案，即导入spring-web坐标，此时 ApplicationContext的继承体系</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-web&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;<span class="number">5.3</span><span class="number">.7</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818132656663.png" alt="image-20240818132656663"></p>
<p>在Spring的web环境下，常用的两个ApplicationContext作用如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>实现类</th>
<th>功能描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>XmlWebApplicationContext</td>
<td>web环境下，加载类路径下的xml配置的ApplicationContext</td>
</tr>
<tr>
<td>AnnotationConfigWebApplicationContext</td>
<td>web环境下，加载磁盘路径下的xml配置的ApplicationContext</td>
</tr>
</tbody>
</table>
</div>
<h1 id="基于xml的Spring应用"><a href="#基于xml的Spring应用" class="headerlink" title="基于xml的Spring应用"></a>基于xml的Spring应用</h1><h2 id="SpringBean-的配置详解"><a href="#SpringBean-的配置详解" class="headerlink" title="SpringBean 的配置详解"></a>SpringBean 的配置详解</h2><p>Spring开发中主要是对Bean的配置，Bean的常用配置一览如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Xml配置方式</th>
<th>功能描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><bean id="" class=""></td>
<td>Bean的id和全限定名配置</td>
</tr>
<tr>
<td><bean name=""></td>
<td>通过name设置Bean的别名，通过别名也能直接获取到Bean实例</td>
</tr>
<tr>
<td><bean scope=""></td>
<td>Bean的作用范围，BeanFactory作为容器时取值singleton和prototype</td>
</tr>
<tr>
<td><bean lazy-init=""></td>
<td>Bean的实例化时机，是否延迟加载。BeanFactory作为容器时无效</td>
</tr>
<tr>
<td><bean init-method=""></td>
<td>Bean实例化后自动执行的初始化方法，method指定方法名</td>
</tr>
<tr>
<td><bean destroy-method=""></td>
<td>Bean实例销毁前的方法，method指定方法名</td>
</tr>
<tr>
<td><bean autowire="byType"></td>
<td>设置自动注入模式，常用的有按照类型byType，按照名字byName</td>
</tr>
<tr>
<td><bean factory-bean="" factory-method=""/></td>
<td>指定哪个工厂Bean的哪个方法完成Bean的创建</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Bean的基础配置"><a href="#Bean的基础配置" class="headerlink" title="Bean的基础配置"></a>Bean的基础配置</h3><p>例如：配置UserDaoImpl由Spring容器负责管理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>此时存储到Spring容器（singleObjects单例池）中的Bean的beanName是userDao，值是UserDaoImpl对象，可 以根据beanName获取Bean实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>如果不配置id，则Spring会把当前Bean实例的全限定名作为beanName</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">applicationContext.getBean(<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Bean的别名配置"><a href="#Bean的别名配置" class="headerlink" title="Bean的别名配置"></a>Bean的别名配置</h3><p>可以为当前Bean指定多个别名，根据别名也可以获得Bean对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> name=<span class="string">&quot;aaa,bbb&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>此时多个名称都可以获得UserDaoImpl实例对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">applicationContext.getBean(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">applicationContext.getBean(<span class="string">&quot;bbb&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Bean的范围配置"><a href="#Bean的范围配置" class="headerlink" title="Bean的范围配置"></a>Bean的范围配置</h3><p>默认情况下，单纯的Spring环境Bean的作用范围有两个：Singleton和Prototype</p>
<ul>
<li>singleton：单例，默认值，Spring容器创建的时候，就会进行Bean的实例化，并存储到容器内部的单例池中 ，每次getBean时都是从单例池中获取相同的Bean实例；</li>
<li>prototype：原型，Spring容器初始化时不会创建Bean实例，当调用getBean时才会实例化Bean，每次 getBean都会创建一个新的Bean实例。</li>
</ul>
<p>当scope设置为singleton时，获得两次对象打印结果是一样的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span> scope=<span class="string">&quot;singleton&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">userDao</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">userDao2</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">System.out.println(userDao); <span class="comment">//com.itheima.dao.impl.UserDaoImpl@631330c</span></span><br><span class="line">System.out.println(userDao2); <span class="comment">//com.itheima.dao.impl.UserDaoImpl@631330c</span></span><br></pre></td></tr></table></figure>
<p>通过断点调试，观察可以发现单例池中存在 userDao 实例</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818134852072.png" alt="image-20240818134852072"></p>
<p>当scope设置为prototype时，获得两次对象打印结果是不一样的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span> scope=<span class="string">&quot;prototype&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">userDao</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">userDao2</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">System.out.println(userDao); <span class="comment">//com.itheima.dao.impl.UserDaoImpl@4d50efb8</span></span><br><span class="line">System.out.println(userDao2); <span class="comment">//com.itheima.dao.impl.UserDaoImpl@7e2d773b</span></span><br></pre></td></tr></table></figure>
<p>通过断点调试，观察可以发现单例池中不存在 userDao 实例，但是 userDao的信息已经被存储到 beanDefinitionMap中了</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818134945011.png" alt="image-20240818134945011"></p>
<h3 id="Bean的延迟加载"><a href="#Bean的延迟加载" class="headerlink" title="Bean的延迟加载"></a>Bean的延迟加载</h3><p>当lazy-init设置为true时为延迟加载，也就是当Spring容器创建的时候，不会立即创建Bean实例，等待用到时在创 建Bean实例并存储到单例池中去，后续在使用该Bean直接从单例池获取即可，本质上该Bean还是单例的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span> lazy-init=<span class="string">&quot;true&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Bean的初始化和销毁方法配置"><a href="#Bean的初始化和销毁方法配置" class="headerlink" title="Bean的初始化和销毁方法配置"></a>Bean的初始化和销毁方法配置</h3><p>Bean在被实例化后，可以执行指定的初始化方法完成一些初始化的操作，Bean在销毁之前也可以执行指定的销毁 方法完成一些操作，初始化方法名称和销毁方法名称通过</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span> init-method=<span class="string">&quot;init&quot;</span> </span><br><span class="line">destroy-method=<span class="string">&quot;destroy&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;UserDaoImpl创建了...&quot;</span>); &#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123; System.out.println(<span class="string">&quot;初始化方法...&quot;</span>); &#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123; System.out.println(<span class="string">&quot;销毁方法...&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>扩展：除此之外，我们还可以通过实现 InitializingBean 接口，完成一些Bean的初始化操作，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>, InitializingBean &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">()</span> &#123;System.out.println(<span class="string">&quot;UserDaoImpl创建了...&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;System.out.println(<span class="string">&quot;初始化方法...&quot;</span>);&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;System.out.println(<span class="string">&quot;销毁方法...&quot;</span>);&#125;</span><br><span class="line">	<span class="comment">//执行时机早于init-method配置的方法</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;InitializingBean...&quot;</span>); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Bean的实例化配置"><a href="#Bean的实例化配置" class="headerlink" title="Bean的实例化配置"></a>Bean的实例化配置</h3><p>Spring的实例化方式主要如下两种：</p>
<ul>
<li>构造方式实例化：底层通过构造方法对Bean进行实例化</li>
<li>工厂方式实例化：底层通过调用自定义的工厂方法对Bean进行实例化</li>
</ul>
<p>构造方式实例化Bean又分为无参构造方法实例化和有参构造方法实例化，Spring中配置的几乎都是无参构 造该方式，此处不在赘述。下面讲解有参构造方法实例化Bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有参构造方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">(String name)</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有参构造在实例化Bean时，需要参数的注入，通过标签，嵌入在标签内部提供构造参 数，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;</span><br><span class="line">	&lt;constructor-arg name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;haohao&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>工厂方式实例化Bean，又分为如下三种：</p>
<ul>
<li>静态工厂方法实例化Bean</li>
<li>实例工厂方法实例化Bean</li>
<li>实现FactoryBean规范延迟实例化Bean</li>
</ul>
<h4 id="静态工厂方法实例化Bean"><a href="#静态工厂方法实例化Bean" class="headerlink" title="静态工厂方法实例化Bean"></a>静态工厂方法实例化Bean</h4><p>静态工厂方法实例化Bean，其实就是定义一个工厂类，提供一个静态方法用于生产Bean实例，在将该工厂类及其 静态方法配置给Spring即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//工厂类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoFactoryBean</span> &#123;</span><br><span class="line">	<span class="comment">//非静态工厂方法</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> UserDao <span class="title function_">getUserDao</span><span class="params">(String name)</span>&#123;</span><br><span class="line">		<span class="comment">//可以在此编写一些其他逻辑代码</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>静态工厂方法实例化Bean，其实就是定义一个工厂类，提供一个静态方法用于生产Bean实例，在将该工厂类及其 静态方法配置给Spring即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.factory.UserDaoFactoryBean&quot;</span> factory-method=<span class="string">&quot;getUserDao&quot;</span>&gt;</span><br><span class="line">	&lt;constructor-arg name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;haohao&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PS：标签不仅仅是为构造方法传递参数，只要是为了实例化对象而传递的参数都可以通过 标签完成，例如上面通过静态工厂方法实例化Bean所传递的参数也是要通过 进行传递的</p>
</blockquote>
<p>测试代码，直接通过ApplicationContext获得userDao即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathxmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">userDao</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">System.out.println(userDao);</span><br></pre></td></tr></table></figure>
<p>断点调试，UserDaoImpl实例对象会存在于单例池中</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818135525725.png" alt="image-20240818135525725"></p>
<h4 id="实例工厂方法"><a href="#实例工厂方法" class="headerlink" title="实例工厂方法"></a>实例工厂方法</h4><p>实例工厂方法，也就是非静态工厂方法产生Bean实例，与静态工厂方式比较，该方式需要先有工厂对象，在用工厂 对象去调用非静态方法，所以在进行配置时，要先配置工厂Bean，在配置目标Bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//工厂类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoFactoryBean2</span> &#123;</span><br><span class="line">	<span class="comment">//非静态工厂方法</span></span><br><span class="line">	<span class="keyword">public</span> UserDao <span class="title function_">getUserDao</span><span class="params">(String name)</span>&#123;</span><br><span class="line">	<span class="comment">//可以在此编写一些其他逻辑代码</span></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实例工厂方法，也就是非静态工厂方法产生Bean实例，与静态工厂方式比较，该方式需要先有工厂对象，在用工厂 对象去调用非静态方法，所以在进行配置时，要先配置工厂Bean，在配置目标Bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置实例工厂Bean --&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;userDaoFactoryBean2&quot;</span> class=<span class="string">&quot;com.itheima.factory.UserDaoFactoryBean2&quot;</span>/&gt;</span><br><span class="line">&lt;!-- 配置实例工厂Bean的哪个方法作为工厂方法 --&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> factory-bean=<span class="string">&quot;userDaoFactoryBean2&quot;</span> factory-method=<span class="string">&quot;getUserDao&quot;</span>&gt;</span><br><span class="line">&lt;constructor-arg name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;haohao&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>测试代码同上，直接通过ApplicationContext获得userDao即可，不在赘述 通过断点观察单例</p>
<p>singletonObjects，发现单例池中既有工厂Bean实例，也有目标Bean实例，且都是在Spring 容器创建时，就完成了Bean的实例化</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818135736204.png" alt="image-20240818135736204"></p>
<h4 id="FactoryBean规范延迟实例化Bean"><a href="#FactoryBean规范延迟实例化Bean" class="headerlink" title="FactoryBean规范延迟实例化Bean"></a>FactoryBean规范延迟实例化Bean</h4><p>上面不管是静态工厂方式还是非静态工厂方式，都是自定义的工厂方法，Spring提供了FactoryBean的接口规范， FactoryBean接口定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line">	<span class="type">String</span> <span class="variable">OBJECT_TYPE_ATTRIBUTE</span> <span class="operator">=</span> “factoryBeanObjectType”;</span><br><span class="line">	T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception; <span class="comment">//获得实例对象方法</span></span><br><span class="line">	Class&lt;?&gt; getObjectType(); <span class="comment">//获得实例对象类型方法</span></span><br><span class="line">	<span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义工厂实现FactoryBean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoFactoryBean3</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;UserDao&gt; &#123;</span><br><span class="line">	<span class="keyword">public</span> UserDao <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">		<span class="keyword">return</span> UserDao.class;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置FactoryBean交由Spring管理即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.factory.UserDaoFactoryBean3&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>通过Spring容器根据beanName可以正常获得UserDaoImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathxmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">userDao</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">System.out.println(userDao);</span><br></pre></td></tr></table></figure>
<p>通过断点观察发现Spring容器创建时，FactoryBean被实例化了，并存储到了单例池singletonObjects中，但是 getObject() 方法尚未被执行，UserDaoImpl也没被实例化，当首次用到UserDaoImpl时，才调用getObject() ， 此工厂方式产生的Bean实例不会存储到单例池singletonObjects中，会存储到 factoryBeanObjectCache 缓存池 中，并且后期每次使用到userDao都从该缓存池中返回的是同一个userDao实例。</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818135952908.png" alt="image-20240818135952908"></p>
<h3 id="Bean的依赖注入配置"><a href="#Bean的依赖注入配置" class="headerlink" title="Bean的依赖注入配置"></a>Bean的依赖注入配置</h3><p>依赖注入的数据类型有如下三种：</p>
<ul>
<li>普通数据类型，例如：String、int、boolean等，通过value属性指定。</li>
<li>引用数据类型，例如：UserDaoImpl、DataSource等，通过ref属性指定。</li>
<li>集合数据类型，例如：List、Map、Properties等。</li>
</ul>
<p>注入 List 集合 – 普通数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">setStrList</span><span class="params">(List&lt;String&gt; strList)</span>&#123;</span><br><span class="line">	strList.forEach(str-&gt;&#123;</span><br><span class="line">		System.out.println(str);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;property name=<span class="string">&quot;strList&quot;</span>&gt;</span><br><span class="line">	&lt;list&gt;</span><br><span class="line">		&lt;value&gt;haohao&lt;/value&gt;</span><br><span class="line">		&lt;value&gt;miaomiao&lt;/value&gt;</span><br><span class="line">	&lt;/list&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注入 List 集合 – 引用数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setObjList</span><span class="params">(List&lt;UserDao&gt; objList)</span>&#123;</span><br><span class="line">	objList.forEach(obj-&gt;&#123;</span><br><span class="line">		System.out.println(obj);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;property name=<span class="string">&quot;objList&quot;</span>&gt;</span><br><span class="line">	&lt;list&gt;</span><br><span class="line">		&lt;bean class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">		&lt;bean class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">		&lt;bean class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">	&lt;/list&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<p>注入 List 集合 – 引用数据,也可以直接引用容器中存在的Bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置UserDao--&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>/&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;userDao2&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>/&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;userDao3&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>/&gt;</span><br><span class="line">&lt;!--配置UserService--&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">	&lt;property name=<span class="string">&quot;objList&quot;</span>&gt;</span><br><span class="line">		&lt;list&gt;</span><br><span class="line">			&lt;ref bean=<span class="string">&quot;userDao&quot;</span>&gt;&lt;/ref&gt;</span><br><span class="line">			&lt;ref bean=<span class="string">&quot;userDao2&quot;</span>&gt;&lt;/ref&gt;</span><br><span class="line">			&lt;ref bean=<span class="string">&quot;userDao3&quot;</span>&gt;&lt;/ref&gt;</span><br><span class="line">		&lt;/list&gt;</span><br><span class="line">	&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>注入 Set 集合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//注入泛型为字符串的Set集合</span><br><span class="line">public void setValueSet(Set&lt;String&gt; valueSet)&#123;</span><br><span class="line">	valueSet.forEach(str-&gt;&#123;</span><br><span class="line">		System.out.println(str);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line">//注入泛型为对象的Set集合</span><br><span class="line">public void setObjSet(Set&lt;UserDao&gt; objSet)&#123;</span><br><span class="line">	objSet.forEach(obj-&gt;&#123;</span><br><span class="line">		System.out.println(obj);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 注入泛型为字符串的Set集合 --&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;valueSet&quot;</span>&gt;</span><br><span class="line">	&lt;set&gt;</span><br><span class="line">		&lt;value&gt;muzi&lt;/value&gt;</span><br><span class="line">		&lt;value&gt;muran&lt;/value&gt;</span><br><span class="line">	&lt;/set&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;!-- 注入泛型为对象的Set集合 --&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;objSet&quot;</span>&gt;</span><br><span class="line">	&lt;set&gt;</span><br><span class="line">		&lt;ref bean=<span class="string">&quot;userDao&quot;</span>&gt;&lt;/ref&gt;</span><br><span class="line">		&lt;ref bean=<span class="string">&quot;userDao2&quot;</span>&gt;&lt;/ref&gt;</span><br><span class="line">		&lt;ref bean=<span class="string">&quot;userDao3&quot;</span>&gt;&lt;/ref&gt;</span><br><span class="line">	&lt;/set&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<p>注入 Map 集合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//注入值为字符串的Map集合</span><br><span class="line">public void setValueMap(Map&lt;String,String&gt; valueMap)&#123;</span><br><span class="line">	valueMap.forEach((k,v)-&gt;&#123;</span><br><span class="line">		System.out.println(k+&quot;==&quot;+v);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line">//注入值为对象的Map集合</span><br><span class="line">public void setObjMap(Map&lt;String,UserDao&gt; objMap)&#123;</span><br><span class="line">	objMap.forEach((k,v)-&gt;&#123;</span><br><span class="line">		System.out.println(k+&quot;==&quot;+v);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--注入值为字符串的Map集合--&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;valueMap&quot;</span>&gt;</span><br><span class="line">	&lt;map&gt;</span><br><span class="line">		&lt;entry key=<span class="string">&quot;aaa&quot;</span> value=<span class="string">&quot;AAA&quot;</span> /&gt;</span><br><span class="line">		&lt;entry key=<span class="string">&quot;bbb&quot;</span> value=<span class="string">&quot;BBB&quot;</span> /&gt;</span><br><span class="line">		&lt;entry key=<span class="string">&quot;ccc&quot;</span> value=<span class="string">&quot;CCC&quot;</span> /&gt;</span><br><span class="line">	&lt;/map&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;!--注入值为对象的Map集合--&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;objMap&quot;</span>&gt;</span><br><span class="line">	&lt;map&gt;</span><br><span class="line">		&lt;entry key=<span class="string">&quot;ud&quot;</span> value-ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">		&lt;entry key=<span class="string">&quot;ud2&quot;</span> value-ref=<span class="string">&quot;userDao2&quot;</span>/&gt;</span><br><span class="line">		&lt;entry key=<span class="string">&quot;ud3&quot;</span> value-ref=<span class="string">&quot;userDao3&quot;</span>/&gt;</span><br><span class="line">	&lt;/map&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<p>注入 Properties 键值对</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注入Properties</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span>&#123;</span><br><span class="line">	properties.forEach((k,v)-&gt;&#123;</span><br><span class="line">		System.out.println(k+<span class="string">&quot;==&quot;</span>+v);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;property name=<span class="string">&quot;properties&quot;</span>&gt;</span><br><span class="line">	&lt;props&gt;</span><br><span class="line">		&lt;prop key=<span class="string">&quot;xxx&quot;</span>&gt;XXX&lt;/prop&gt;</span><br><span class="line">		&lt;prop key=<span class="string">&quot;yyy&quot;</span>&gt;YYY&lt;/prop&gt;</span><br><span class="line">	&lt;/props&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>扩展：自动装配方式</p>
<p>如果被注入的属性类型是Bean引用的话，那么可以在 标签中使用 autowire 属性去配置自动注入方式，属 性值有两个：</p>
<ul>
<li>byName：通过属性名自动装配，即去匹配 setXxx 与 id=”xxx”（name=”xxx”）是否一致；</li>
<li>byType：通过Bean的类型从容器中匹配，匹配出多个相同Bean类型时，报错。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span> </span><br><span class="line">autowire=<span class="string">&quot;byType&quot;</span>&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Spring的其他配置标签"><a href="#Spring的其他配置标签" class="headerlink" title="Spring的其他配置标签"></a>Spring的其他配置标签</h3><p>Spring 的 xml 标签大体上分为两类，一种是默认标签，一种是自定义标签</p>
<ul>
<li>默认标签：就是不用额外导入其他命名空间约束的标签，例如<code>&lt;bean&gt;</code>标签</li>
<li>自定义标签：就是需要额外引入其他命名空间约束，并通过前缀引用的标签，例如<code>&lt;context:property- placeholder/&gt;</code>标签</li>
</ul>
<p>Spring的默认标签用到的是Spring的默认命名空间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">	xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">	xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p>该命名空间约束下的默认标签如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>标签</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><beans></td>
<td>一般作为 xml 配置根标签，其他标签都是该标签的子标签</td>
</tr>
<tr>
<td><bean></td>
<td>Bean的配置标签，上面已经详解了，此处不再阐述</td>
</tr>
<tr>
<td><import></td>
<td>外部资源导入标签</td>
</tr>
<tr>
<td><alias></td>
<td>指定Bean的别名标签，使用较少</td>
</tr>
</tbody>
</table>
</div>
<p><beans>标签，除了经常用的做为根标签外，还可以嵌套在根标签内，使用profile属性切换开发环境</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置测试环境下，需要加载的Bean实例 --&gt;</span><br><span class="line">&lt;beans profile=<span class="string">&quot;test&quot;</span>&gt;</span><br><span class="line">&lt;/beans&gt;</span><br><span class="line">&lt;!-- 配置开发环境下，需要加载的Bean实例 --&gt;</span><br><span class="line">&lt;beans profile=<span class="string">&quot;dev&quot;</span>&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p>可以使用以下两种方式指定被激活的环境：</p>
<ul>
<li>使用命令行动态参数，虚拟机参数位置加载 <code>-Dspring.profiles.active=test</code></li>
<li>使用代码的方式设置环境变量 <code>System.setProperty(&quot;spring.profiles.active&quot;,&quot;test&quot;)</code></li>
</ul>
<p><import>标签，用于导入其他配置文件，项目变大后，就会导致一个配置文件内容过多，可以将一个配置文件根 据业务某块进行拆分，拆分后，最终通过标签导入到一个主配置文件中，项目加载主配置文件就连同<import>导入的文件一并加载了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--导入用户模块配置文件--&gt;</span><br><span class="line">&lt;<span class="keyword">import</span> resource=<span class="string">&quot;classpath:UserModuleApplicationContext.xml&quot;</span>/&gt;</span><br><span class="line">&lt;!--导入商品模块配置文件--&gt;</span><br><span class="line">&lt;<span class="keyword">import</span> resource=<span class="string">&quot;classpath:ProductModuleApplicationContext.xml&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p><alias>标签是为某个Bean添加别名，与在<bean>标签上使用name属性添加别名的方式一样，我们为 UserServiceImpl指定四个别名：aaa、bbb、xxx、yyy</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置UserService--&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;userService&quot;</span> name=<span class="string">&quot;aaa,bbb&quot;</span> class=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">	&lt;property name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!--指定别名--&gt;</span><br><span class="line">&lt;alias name=<span class="string">&quot;userService&quot;</span> alias=<span class="string">&quot;xxx&quot;</span>/&gt;</span><br><span class="line">&lt;alias name=<span class="string">&quot;userService&quot;</span> alias=<span class="string">&quot;yyy&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>断点调试，在beanFactory中维护着一个名为aliasMap的Map集合，存储别名和beanName 之间的映射关系</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818141550308.png" alt="image-20240818141550308"></p>
<p>Spring的自定义标签需要引入外部的命名空间，并为外部的命名空间指定前缀，使用 &lt;前缀:标签&gt; 形式的标签，称 之为自定义标签，自定义标签的解析流程也是 Spring xml扩展点方式之一，在《Spring整合其他框架》章节进行 详细介绍</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--默认标签--&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>/&gt;</span><br><span class="line">&lt;!--自定义标签--&gt;</span><br><span class="line">&lt;context:property-placeholder/&gt;</span><br><span class="line">&lt;mvc:annotation-driven/&gt;</span><br><span class="line">&lt;dubbo:application name=<span class="string">&quot;application&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Spring-的get方法"><a href="#Spring-的get方法" class="headerlink" title="Spring 的get方法"></a>Spring 的get方法</h2><div class="table-container">
<table>
<thead>
<tr>
<th>方法定义</th>
<th>返回值和参数</th>
</tr>
</thead>
<tbody>
<tr>
<td>Object getBean (String beanName)</td>
<td>根据beanName从容器中获取Bean实例，要求容器中Bean唯一，返回值为Object，需要强转</td>
</tr>
<tr>
<td>T getBean (Class type)</td>
<td>根据Class类型从容器中获取Bean实例，要求容器中Bean类型唯一，返回值为Class类型实例， 无需强转</td>
</tr>
<tr>
<td>T getBean (String beanName，Class type)</td>
<td>根据beanName从容器中获得Bean实例，返回值为Class类型实例，无需强转</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据beanName获取容器中的Bean实例，需要手动强转</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) applicationContext.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line"><span class="comment">//根据Bean类型去容器中匹配对应的Bean实例，如存在多个匹配Bean则报错</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService2</span> <span class="operator">=</span> applicationContext.getBean(UserService.class);</span><br><span class="line"><span class="comment">//根据beanName获取容器中的Bean实例，指定Bean的Type类型</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService3</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userService&quot;</span>, </span><br><span class="line">UserService.class);</span><br></pre></td></tr></table></figure>
<h2 id="Spring-配置非自定义Bean"><a href="#Spring-配置非自定义Bean" class="headerlink" title="Spring 配置非自定义Bean"></a>Spring 配置非自定义Bean</h2><p>以上在 xml 中配置的Bean都是自己定义的，例如：UserDaoImpl，UserServiceImpl。但是，在实际开发中有些 功能类并不是我们自己定义的，而是使用的第三方jar包中的，那么，这些Bean要想让Spring进行管理，也需要对 其进行配置</p>
<p>配置非自定义的Bean需要考虑如下两个问题：</p>
<ul>
<li>被配置的Bean的实例化方式是什么？无参构造、有参构造、静态工厂方式还是实例工厂方式；</li>
<li>被配置的Bean是否需要注入必要属性。</li>
</ul>
<h3 id="配置-Druid-数据源交由Spring管理"><a href="#配置-Druid-数据源交由Spring管理" class="headerlink" title="配置 Druid 数据源交由Spring管理"></a>配置 Druid 数据源交由Spring管理</h3><p>导入Druid坐标</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- mysql驱动 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;<span class="number">5.1</span><span class="number">.49</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- druid数据源 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;<span class="number">1.1</span><span class="number">.23</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>配置 DruidDataSource</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置 DruidDataSource数据源--&gt;</span><br><span class="line">&lt;bean class=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span><br><span class="line">&lt;!--配置必要属性--&gt;</span><br><span class="line">	&lt;property name=<span class="string">&quot;driverClassName&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br><span class="line">	&lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc://localhost:3306/mybatis&quot;</span>/&gt;</span><br><span class="line">	&lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">	&lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<h3 id="配置Connection交由Spring管理"><a href="#配置Connection交由Spring管理" class="headerlink" title="配置Connection交由Spring管理"></a>配置Connection交由Spring管理</h3><p>Connection 的产生是通过DriverManager的静态方法getConnection获取的，所以我们要用静态工厂方式配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean class=<span class="string">&quot;java.lang.Class&quot;</span> factory-method=<span class="string">&quot;forName&quot;</span>&gt;</span><br><span class="line">	&lt;constructor-arg name=<span class="string">&quot;className&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;connection&quot;</span> class=<span class="string">&quot;java.sql.DriverManager&quot;</span> factory-method=<span class="string">&quot;getConnection&quot;</span> </span><br><span class="line">scope=<span class="string">&quot;prototype&quot;</span>&gt;</span><br><span class="line">	&lt;constructor-arg name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql:///mybatis&quot;</span>/&gt;</span><br><span class="line">	&lt;constructor-arg name=<span class="string">&quot;user&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">	&lt;constructor-arg name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<h3 id="配置日期对象交由Spring管理"><a href="#配置日期对象交由Spring管理" class="headerlink" title="配置日期对象交由Spring管理"></a>配置日期对象交由Spring管理</h3><p>产生一个指定日期格式的对象，原始代码按如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">currentTimeStr</span> <span class="operator">=</span> <span class="string">&quot;2023-08-27 07:20:00&quot;</span>;</span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> simpleDateFormat.parse(currentTimeStr);</span><br></pre></td></tr></table></figure>
<p>可以看成是实例工厂方式，使用Spring配置方式产生Date实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;simpleDateFormat&quot;</span> class=<span class="string">&quot;java.text.SimpleDateFormat&quot;</span>&gt;</span><br><span class="line">	&lt;constructor-arg name=<span class="string">&quot;pattern&quot;</span> value=<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;date&quot;</span> factory-bean=<span class="string">&quot;simpleDateFormat&quot;</span> factory-method=<span class="string">&quot;parse&quot;</span>&gt;</span><br><span class="line">	&lt;constructor-arg name=<span class="string">&quot;source&quot;</span> value=<span class="string">&quot;2023-08-27 07:20:00&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<h3 id="配置MyBatis的SqlSessionFactory交由Spring管理"><a href="#配置MyBatis的SqlSessionFactory交由Spring管理" class="headerlink" title="配置MyBatis的SqlSessionFactory交由Spring管理"></a>配置MyBatis的SqlSessionFactory交由Spring管理</h3><p>导入MyBatis的相关坐标：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--mybatis框架--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;<span class="number">3.5</span><span class="number">.5</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- mysql驱动 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;<span class="number">5.1</span><span class="number">.49</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>MyBatis原始获得SqlSessionFactory的方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载mybatis核心配置文件，使用Spring静态工厂方式</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Resources.getResourceAsStream(“mybatis-conifg.xml”);</span><br><span class="line"><span class="comment">//创建SqlSessionFactoryBuilder对象，使用Spring无参构造方式</span></span><br><span class="line"><span class="type">SqlSessionFactoryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"><span class="comment">//调用SqlSessionFactoryBuilder的build方法，使用Spring实例工厂方式</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> builder.build(in);</span><br></pre></td></tr></table></figure>
<p>SqlSessionFactory交由Spring管理配置如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--静态工厂方式产生Bean实例--&gt;</span><br><span class="line">&lt;bean id=“inputStream” class=“org.apache.ibatis.io.Resources” factory-method=“getResourceAsStream”&gt;</span><br><span class="line">	&lt;constructor-arg name=“resource” value=“mybatis-config.xml/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!--无参构造方式产生Bean实例--&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;sqlSessionFactoryBuilder&quot;</span> class=<span class="string">&quot;org.apache.ibatis.session.SqlSessionFactoryBuilder&quot;</span>/&gt;</span><br><span class="line">&lt;!--实例工厂方式产生Bean实例--&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;sqlSessionFactory&quot;</span> factory-bean=<span class="string">&quot;sqlSessionFactoryBuilder&quot;</span> factory-method=<span class="string">&quot;build&quot;</span>&gt;</span><br><span class="line">	&lt;constructor-arg name=<span class="string">&quot;inputStream&quot;</span> ref=<span class="string">&quot;inputStream&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Bean-实例化的基本流程"><a href="#Bean-实例化的基本流程" class="headerlink" title="Bean 实例化的基本流程"></a>Bean 实例化的基本流程</h2><p>Spring容器在进行初始化时，会将xml配置的的信息封装成一个BeanDefinition对象，所有的 BeanDefinition存储到一个名为beanDefinitionMap的Map集合中去，Spring框架在对该Map进行遍历，使用反 射创建Bean实例对象，创建好的Bean对象存储在一个名为singletonObjects的Map集合中，当调用getBean方法 时则最终从该Map集合中取出Bean实例对象返回。</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818190555518.png" alt="image-20240818190555518"></p>
<p>DefaultListableBeanFactory对象内部维护着一个Map用于存储封装好的BeanDefinitionMap</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultListableBeanFactory</span> extends ... implements ... &#123;</span><br><span class="line"><span class="comment">//存储&lt;bean&gt;标签对应的BeanDefinition对象</span></span><br><span class="line"><span class="comment">//key:是Bean的beanName，value:是Bean定义对象BeanDefinition</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, BeanDefinition&gt; beanDefinitionMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring框架会取出beanDefinitionMap中的每个BeanDefinition信息，反射构造方法或调用指定的工厂方法 生成Bean实例对象，所以<code>只要将BeanDefinition注册到beanDefinitionMap这个Map中，Spring就会进行对 应的Bean的实例化操作</code>.</p>
<p>Bean实例及单例池singletonObjects， beanDefinitionMap中的BeanDefinition会被转化成对应的Bean实例对象 ，存储到单例池singletonObjects中去，在DefaultListableBeanFactory的上四级父类 DefaultSingletonBeanRegistry中，维护着singletonObjects，源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSingletonBeanRegistry</span> extends ... implements ... &#123;</span><br><span class="line">	<span class="comment">//存储Bean实例的单例池</span></span><br><span class="line">	<span class="comment">////key:是Bean的beanName，value:是Bean的实例对象</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">256</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Bean 实例化的基本流程:</p>
<ul>
<li>加载xml配置文件，解析获取配置中的每个的信息，封装成一个个的BeanDefinition对象;</li>
<li>将BeanDefinition存储在一个名为beanDefinitionMap的Map中;</li>
<li>ApplicationContext底层遍历beanDefinitionMap，创建Bean实例对象;</li>
<li>创建好的Bean实例对象，被存储到一个名为singletonObjects的Map中;</li>
<li>当执行applicationContext.getBean(beanName)时，从singletonObjects去匹配Bean实例返回。</li>
</ul>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818190816407.png" alt="image-20240818190816407"></p>
<h2 id="Spring的后处理器"><a href="#Spring的后处理器" class="headerlink" title="Spring的后处理器"></a>Spring的后处理器</h2><p>Spring的后处理器是Spring对外开发的重要扩展点，允许我们介入到Bean的整个实例化流程中来，以达到动态注册 BeanDefinition，动态修改BeanDefinition，以及动态修改Bean的作用。Spring主要有两种后处理器：</p>
<ul>
<li>BeanFactoryPostProcessor：Bean工厂后处理器，在BeanDefinitionMap填充完毕，Bean实例化之前执行；</li>
<li>BeanPostProcessor：Bean后处理器，一般在Bean实例化之后，填充到单例池singletonObjects之前执行。</li>
</ul>
<p>Bean工厂后处理器 – BeanFactoryPostProcessor</p>
<p>BeanFactoryPostProcessor是一个接口规范，实现了该接口的类只要交由Spring容器管理的话，那么Spring就会回 调该接口的方法，用于对BeanDefinition注册和修改的功能。</p>
<p>BeanFactoryPostProcessor 定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Bean工厂后处理器 – BeanFactoryPostProcessor</p>
<p>编写BeanFactoryPostProcessor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;MyBeanFactoryPostProcessor执行了...&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置BeanFactoryPostProcessor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean class=<span class="string">&quot;com.itheima.processor.MyBeanFactoryPostProcessor&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>postProcessBeanFactory 参数本质就是 DefaultListableBeanFactory，拿到BeanFactory的引用，自然就可以 对beanDefinitionMap中的BeanDefinition进行操作了 ，例如对UserDaoImpl的BeanDefinition进行修改操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> </span><br><span class="line"><span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">		<span class="type">BeanDefinition</span> <span class="variable">userDaoBD</span> <span class="operator">=</span> beanFactory.getBeanDefinition(“userDao”);<span class="comment">//获得UserDao定义对象</span></span><br><span class="line">		userDaoBD.setBeanClassName(<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl2&quot;</span>); <span class="comment">//修改class</span></span><br><span class="line">		<span class="comment">//userDaoBD.setInitMethodName(methodName); //修改初始化方法</span></span><br><span class="line">		<span class="comment">//userDaoBD.setLazyInit(true); //修改是否懒加载</span></span><br><span class="line">		<span class="comment">//... 省略其他的设置方式 ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面已经对指定的BeanDefinition进行了修改操作，下面对BeanDefiition进行注册操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">		<span class="comment">//强转成子类DefaultListableBeanFactory</span></span><br><span class="line">		<span class="keyword">if</span>(configurableListableBeanFactory <span class="keyword">instanceof</span> DefaultListableBeanFactory)&#123;</span><br><span class="line">			<span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> (DefaultListableBeanFactory) </span><br><span class="line">configurableListableBeanFactory;</span><br><span class="line">			<span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">			beanDefinition.setBeanClassName(<span class="string">&quot;com.itheima.dao.UserDaoImpl2&quot;</span>);</span><br><span class="line">			<span class="comment">//进行注册操作</span></span><br><span class="line">			beanFactory.registerBeanDefinition(<span class="string">&quot;userDao2&quot;</span>,beanDefinition);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring 提供了一个BeanFactoryPostProcessor的子接口BeanDefinitionRegistryPostProcessor专门用于注册 BeanDefinition操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor2</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry beanDefinitionRegistry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">		<span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">		beanDefinition.setBeanClassName(<span class="string">&quot;com.itheima.dao.UserDaoImpl2&quot;</span>);</span><br><span class="line">		beanDefinitionRegistry.registerBeanDefinition(<span class="string">&quot;userDao2&quot;</span>,beanDefinition);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义@MyComponent注解，使用在类上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyComponent &#123;</span><br><span class="line">	<span class="comment">//显示的指定Bean的beanName</span></span><br><span class="line">	String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在类上使用@MyComponent</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyComponent(&quot;otherBean&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OtherBean</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义BeanFactoryPostProcessor完成注解解析</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">	<span class="comment">//指定要扫描的包</span></span><br><span class="line">	<span class="type">String</span> <span class="variable">basePackage</span> <span class="operator">=</span> <span class="string">&quot;com.itheima&quot;</span>;</span><br><span class="line">	<span class="comment">//调用扫描工具扫描指定包及其子包下的@MyComponent</span></span><br><span class="line">	Map&lt;String, Class&gt; myComponentClassMap = </span><br><span class="line">	BaseClassScanUtils.scanMyComponentAnnotation(basePackage);</span><br><span class="line">	<span class="comment">//遍历Map集合，创建BeanDefinition对象进行注册</span></span><br><span class="line">	myComponentClassMap.forEach((beanName,clazz)-&gt;&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">			beanDefinition.setBeanClassName(clazz.getName());</span><br><span class="line">			registry.registerBeanDefinition(beanName,beanDefinition);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BeanFactoryPostProcessor 在 SpringBean的实例化过程中的体现</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818191644265.png" alt="image-20240818191644265"></p>
<p>Bean被实例化后，到最终缓存到名为singletonObjects单例池之前，中间会经过Bean的初始化过程，例如：属性的 填充、初始方法init的执行等，其中有一个对外进行扩展的点BeanPostProcessor，我们称为Bean后处理。跟上面的 Bean工厂后处理器相似，它也是一个接口，实现了该接口并被容器管理的BeanPostProcessor，会在流程节点上被 Spring自动调用</p>
<p>BeanPostProcessor的接口定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="comment">//在属性注入完毕，init初始化方法执行之前被回调</span></span><br><span class="line">	<span class="keyword">default</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> </span><br><span class="line">BeansException &#123;</span><br><span class="line">		<span class="keyword">return</span> bean;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="comment">//在初始化方法执行之后，被添加到单例池singletonObjects之前被回调</span></span><br><span class="line">	<span class="keyword">default</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> </span><br><span class="line">BeansException &#123;</span><br><span class="line">		<span class="keyword">return</span> bean;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义MyBeanPostProcessor，完成快速入门测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">	<span class="comment">/* 参数： bean是当前被实例化的Bean，beanName是当前Bean实例在容器中的名称返回值：当前Bean实例对象 */</span></span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;BeanPostProcessor的before方法...&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> bean;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 参数： bean是当前被实例化的Bean，beanName是当前Bean实例在容器中的名称返回值：当前Bean实例对象 */</span></span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;BeanPostProcessor的after方法...&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> bean;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置MyBeanPostProcessor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean class=<span class="string">&quot;com.itheima.processors.MyBeanPostProcessor&quot;</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>测试控制台打印结果如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UserDaoImpl创建了...</span><br><span class="line">UserDaoImpl属性填充...</span><br><span class="line">BeanPostProcessor的before方法...</span><br><span class="line">UserDaoImpl初始化方法执行...</span><br><span class="line">BeanPostProcessor的after方法...</span><br></pre></td></tr></table></figure>
<h2 id="Spring-Bean的生命周期"><a href="#Spring-Bean的生命周期" class="headerlink" title="Spring Bean的生命周期"></a>Spring Bean的生命周期</h2><p>Spring Bean的生命周期是从 Bean 实例化之后，即通过反射创建出对象之后，到Bean成为一个完整对象，最终存储 到单例池中，这个过程被称为Spring Bean的生命周期。Spring Bean的生命周期大体上分为三个阶段：</p>
<ul>
<li>Bean的实例化阶段：Spring框架会取出BeanDefinition的信息进行判断当前Bean的范围是否是singleton的， 是否不是延迟加载的，是否不是FactoryBean等，最终将一个普通的singleton的Bean通过反射进行实例化；</li>
<li>Bean的初始化阶段：Bean创建之后还仅仅是个”半成品”，还需要对Bean实例的属性进行填充、执行一些Aware 接口方法、执行BeanPostProcessor方法、执行InitializingBean接口的初始化方法、执行自定义初始化init方法 等。该阶段是Spring最具技术含量和复杂度的阶段，Aop增强功能，后面要学习的Spring的注解功能等、 spring高频面试题Bean的循环引用问题都是在这个阶段体现的；</li>
<li>Bean的完成阶段：经过初始化阶段，Bean就成为了一个完整的Spring Bean，被存储到单例池 singletonObjects中去了，即完成了Spring Bean的整个生命周期。</li>
</ul>
<p>Spring Bean的初始化过程涉及如下几个过程：</p>
<ul>
<li>Bean实例的属性填充</li>
<li>Aware接口属性注入</li>
<li>BeanPostProcessor的before()方法回调</li>
<li>InitializingBean接口的初始化方法回调</li>
<li>自定义初始化方法init回调</li>
<li>BeanPostProcessor的after()方法回调</li>
</ul>
<h3 id="Bean实例属性填充"><a href="#Bean实例属性填充" class="headerlink" title="Bean实例属性填充"></a>Bean实例属性填充</h3><p>BeanDefinition 中有对当前Bean实体的注入信息通过属性propertyValues进行了存储，例如UserService的属性信息如下:</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818192155660.png" alt="image-20240818192155660"></p>
<p>Spring在进行属性注入时，会分为如下几种情况：</p>
<ul>
<li>注入普通属性，String、int或存储基本类型的集合时，直接通过set方法的反射设置进去；</li>
<li>注入单向对象引用属性时，从容器中getBean获取后通过set方法反射设置进去，如果容器中没有，则先创建被注入对象Bean实例（完成整个生命周期）后，在进行注入操作；</li>
<li>注入双向对象引用属性时，就比较复杂了，涉及了循环引用（循环依赖）问题，下面会详细阐述解决方案。</li>
</ul>
<h4 id="循环依赖"><a href="#循环依赖" class="headerlink" title="循环依赖"></a>循环依赖</h4><p>多个实体之间相互依赖并形成闭环的情况就叫做”循环依赖”，也叫做”循环引用”</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818192337233.png" alt="image-20240818192337233"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserService</span><span class="params">(UserService userService)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">	&lt;property name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;</span><br><span class="line">	&lt;property name=<span class="string">&quot;userService&quot;</span> ref=<span class="string">&quot;userService&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>代码验证后，分析出UserService与UserDao实例化与初始化的顺序如下：</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818192420084.png" alt="image-20240818192420084"></p>
<p>Spring提供了<strong>三级缓存</strong>存储<code>完整Bean实例</code>和<code>半成品Bean实例</code>，用于解决循环引用问题 在DefaultListableBeanFactory的上四级父类DefaultSingletonBeanRegistry中提供如下三个Map：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSingletonBeanRegistry</span> ... &#123;</span><br><span class="line">	<span class="comment">//1、最终存储单例Bean成品的容器，即实例化和初始化都完成的Bean，称之为&quot;一级缓存&quot;</span></span><br><span class="line">	Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">256</span>);</span><br><span class="line">	<span class="comment">//2、早期Bean单例池，缓存半成品对象，且当前对象已经被其他对象引用了，称之为&quot;二级缓存&quot;</span></span><br><span class="line">	Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">16</span>);</span><br><span class="line">	<span class="comment">//3、单例Bean的工厂池，缓存半成品对象，对象未被引用，使用时在通过工厂创建Bean，称之为&quot;三级缓存&quot;</span></span><br><span class="line">	Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>UserService和UserDao循环依赖的过程结合上述三级缓存描述一下:</p>
<ul>
<li>UserService 实例化对象，但尚未初始化，将UserService存储到三级缓存；</li>
<li>UserService 属性注入，需要UserDao，从缓存中获取，没有UserDao；</li>
<li>UserDao实例化对象，但尚未初始化，将UserDao存储到到三级缓存；</li>
<li>UserDao属性注入，需要UserService，从三级缓存获取UserService，UserService从三级缓存移入二级缓存；</li>
<li>UserDao执行其他生命周期过程，最终成为一个完成Bean，存储到一级缓存，删除二三级缓存；</li>
<li>UserService 注入UserDao；</li>
<li>UserService执行其他生命周期过程，最终成为一个完成Bean，存储到一级缓存，删除二三级缓存。</li>
</ul>
<h3 id="常用的Aware接口"><a href="#常用的Aware接口" class="headerlink" title="常用的Aware接口"></a>常用的Aware接口</h3><p>Aware接口是一种框架辅助属性注入的一种思想，其他框架中也可以看到类似的接口。框架具备高度封装性，我们接 触到的一般都是业务代码，一个底层功能API不能轻易的获取到，但是这不意味着永远用不到这些对象，如果用到了 ，就可以使用框架提供的类似Aware的接口，让框架给我们注入该对象。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Aware接口</th>
<th>回调方法</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>ServletContextAware</td>
<td>setServletContext(ServletContext context)</td>
<td>Spring框架回调方法注入ServletContext对象， web环境下才生效</td>
</tr>
<tr>
<td>BeanFactoryAware</td>
<td>setBeanFactory(BeanFactory factory)</td>
<td>Spring框架回调方法注入beanFactory对象</td>
</tr>
<tr>
<td>BeanNameAware</td>
<td>setBeanName(String beanName)</td>
<td>Spring框架回调方法注入当前Bean在容器中 的beanName</td>
</tr>
<tr>
<td>ApplicationContextAware</td>
<td>setApplicationContext(ApplicationContext applicationContext)</td>
<td>Spring框架回调方法注入applicationContext 对象</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Spring-IoC-整体流程总结"><a href="#Spring-IoC-整体流程总结" class="headerlink" title="Spring IoC 整体流程总结"></a>Spring IoC 整体流程总结</h3><p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818192836828.png" alt="image-20240818192836828"></p>
<h2 id="Spring-xml方式整合第三方框架"><a href="#Spring-xml方式整合第三方框架" class="headerlink" title="Spring xml方式整合第三方框架"></a>Spring xml方式整合第三方框架</h2><p>xml整合第三方框架有两种整合方案：</p>
<ul>
<li>不需要自定义名空间，不需要使用Spring的配置文件配置第三方框架本身内容，例如：MyBatis；</li>
<li>需要引入第三方框架命名空间，需要使用Spring的配置文件配置第三方框架本身内容，例如：Dubbo。</li>
</ul>
<h3 id="整合Mybatis"><a href="#整合Mybatis" class="headerlink" title="整合Mybatis"></a>整合Mybatis</h3><p>Spring整合MyBatis，之前已经在Spring中简单的配置了SqlSessionFactory，但是这不是正规的整合方式， MyBatis提供了mybatis-spring.jar专门用于两大框架的整合。</p>
<p>Spring整合MyBatis的步骤如下：</p>
<ul>
<li>导入MyBatis整合Spring的相关坐标；（请见资料中的pom.xml）</li>
<li>编写Mapper和Mapper.xml；</li>
<li>配置SqlSessionFactoryBean和MapperScannerConfigurer；</li>
<li>编写测试代码</li>
</ul>
<p>配置SqlSessionFactoryBean和MapperScannerConfigurer：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置数据源--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置SqlSessionFactoryBean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置Mapper包扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.itheima.dao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>编写Mapper和Mapper.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">	List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.User&quot;</span>&gt;</span></span><br><span class="line">		select * from tb_user</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>编写测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassPathxmlApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathxmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> applicationContext.getBean(UserMapper.class);</span><br><span class="line">List&lt;User&gt; all = userMapper.findAll();</span><br><span class="line">System.out.println(all);</span><br></pre></td></tr></table></figure>
<p>Spring整合MyBatis的原理剖析</p>
<p>整合包里提供了一个SqlSessionFactoryBean和一个扫描Mapper的配置对象，SqlSessionFactoryBean一旦被实例 化，就开始扫描Mapper并通过动态代理产生Mapper的实现类存储到Spring容器中。</p>
<p>相关的有如下四个类：</p>
<ul>
<li>SqlSessionFactoryBean：需要进行配置，用于提供SqlSessionFactory；</li>
<li>MapperScannerConfigurer：需要进行配置，用于扫描指定mapper注册BeanDefinition；</li>
<li>MapperFactoryBean：Mapper的FactoryBean，获得指定Mapper时调用getObject方法；</li>
<li>ClassPathMapperScanner：definition.setAutowireMode(2) 修改了自动注入状态，所以 MapperFactoryBean中的setSqlSessionFactory会自动注入进去。</li>
</ul>
<p>配置SqlSessionFactoryBean作用是向容器中提供SqlSessionFactory，SqlSessionFactoryBean实现了 FactoryBean和InitializingBean两个接口，所以会自动执行getObject() 和afterPropertiesSet()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactoryBean <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;SqlSessionFactory&gt;, InitializingBean&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">//创建SqlSessionFactory对象</span></span><br><span class="line">		<span class="built_in">this</span>.sqlSessionFactory = <span class="built_in">this</span>.buildSqlSessionFactory();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> SqlSessionFactory <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.sqlSessionFactory;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置MapperScannerConfigurer作用是扫描Mapper，向容器中注册Mapper对应的MapperFactoryBean， MapperScannerConfigurer实现了BeanDefinitionRegistryPostProcessor和InitializingBean两个接口，会在 postProcessBeanDefinitionRegistry方法中向容器中注册MapperFactoryBean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MapperScannerConfigurer</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span>, InitializingBean&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">		<span class="type">ClassPathMapperScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathMapperScanner</span>(registry);</span><br><span class="line">		scanner.scan(StringUtils.tokenizeToStringArray(<span class="built_in">this</span>.basePackage, <span class="string">&quot;,; \t\n&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassPathMapperScanner</span> <span class="keyword">extends</span> <span class="title class_">ClassPathBeanDefinitionScanner</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">		Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="built_in">super</span>.doScan(basePackages);</span><br><span class="line">		<span class="keyword">if</span> (beanDefinitions.isEmpty()) &#123;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.processBeanDefinitions(beanDefinitions);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processBeanDefinitions</span><span class="params">(Set&lt;BeanDefinitionHolder&gt; beanDefinitions)</span> &#123;</span><br><span class="line">		<span class="comment">//设置Mapper的beanClass是org.mybatis.spring.mapper.MapperFactoryBean</span></span><br><span class="line">		definition.setBeanClass(<span class="built_in">this</span>.mapperFactoryBeanClass);</span><br><span class="line">		definition.setAutowireMode(<span class="number">2</span>); <span class="comment">//设置MapperBeanFactory 进行自动注入</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PS：autowireMode取值：1是根据名称自动装配，2是根据类型自动装配</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">scan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.doScan(basePackages);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">protected</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">		<span class="comment">//将扫描到的类注册到beanDefinitionMap中，此时beanClass是当前类全限定名</span></span><br><span class="line">		<span class="built_in">this</span>.registerBeanDefinition(definitionHolder, <span class="built_in">this</span>.registry);</span><br><span class="line">		<span class="keyword">return</span> beanDefinitions;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = applicationContext.getBean(UserMapper.class);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperFactoryBean</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">MapperFactoryBean</span><span class="params">(Class&lt;T&gt; mapperInterface)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.mapperInterface = mapperInterface;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSqlSessionFactory</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.sqlSessionTemplate = <span class="built_in">this</span>.createSqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.getSqlSession().getMapper(<span class="built_in">this</span>.mapperInterface);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="命名空间扩展方式"><a href="#命名空间扩展方式" class="headerlink" title="命名空间扩展方式"></a>命名空间扩展方式</h3><p>为了降低此处的学习成本，不在引入Dubbo第三方框架了，以Spring的 context 命名空间去进行讲解，该方式 也是命名空间扩展方式。</p>
<p>需求：加载外部properties文件，将键值对存储在Spring容器中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jdbc.url=jdbc:mysql:<span class="comment">//localhost:3306/mybatis</span></span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=root</span><br></pre></td></tr></table></figure>
<p>引入context命名空间，在使用context命名空间的标签，使用SpEL表达式在xml或注解中根据key获得value</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其实，加载的properties文件中的属性最终通过Spring解析后会被存储到了Spring容器的environment中去，不仅 自己定义的属性会进行存储，Spring也会把环境相关的一些属性进行存储</p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818193853864.png" alt="image-20240818193853864"></p>
<p>原理剖析解析过程，只能从源头ClassPathXmlApplicationContext入手，经历复杂的源码追踪，找到如下两个点：</p>
<ol>
<li>在创建DefaultNamespaceHandlerResolver时，为处理器映射地址handlerMappingsLocation属性赋值，并加 载命名空间处理器到Map handlerMappings 中去</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.handlerMappingsLocation = <span class="string">&quot;META-INF/spring.handlers&quot;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818193935258.png" alt="image-20240818193935258"></p>
<p>第一点完成后，Map集合handlerMappings就被填充了很多XxxNamespaceHandler，继续往下追代码</p>
<ol>
<li>在DefaultBeanDefinitionDocumentReader的parseBeanDefinitions方法中，发现如下逻辑：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果是默认命名空间</span></span><br><span class="line"><span class="keyword">if</span> (delegate.isDefaultNamespace(ele)) &#123;</span><br><span class="line">	<span class="built_in">this</span>.parseDefaultElement(ele, delegate);</span><br><span class="line"><span class="comment">//否则是自定义命名空间</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	delegate.parseCustomElement(ele);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果是默认命名空间，则执行parseDefaultElement方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseDefaultElement</span><span class="params">(Element ele, BeanDefinitionParserDelegate delegate)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;import&quot;</span>)) &#123;</span><br><span class="line">		<span class="built_in">this</span>.importBeanDefinitionResource(ele);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;alias&quot;</span>)) &#123;</span><br><span class="line">		<span class="built_in">this</span>.processAliasRegistration(ele);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;bean&quot;</span>)) &#123;</span><br><span class="line">		<span class="built_in">this</span>.processBeanDefinition(ele, delegate);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;beans&quot;</span>)) &#123;</span><br><span class="line">		<span class="built_in">this</span>.doRegisterBeanDefinitions(ele);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果是自定义命名空间，则执行parseCustomElement方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> BeanDefinition <span class="title function_">parseCustomElement</span><span class="params">(Element ele, <span class="meta">@Nullable</span> BeanDefinition containingBd)</span> &#123;</span><br><span class="line">	<span class="comment">//解析命名空间</span></span><br><span class="line">	<span class="type">String</span> <span class="variable">namespaceUri</span> <span class="operator">=</span> <span class="built_in">this</span>.getNamespaceURI(ele);</span><br><span class="line">	<span class="comment">//获得命名空间解析器</span></span><br><span class="line">	<span class="type">NamespaceHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="built_in">this</span>.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);</span><br><span class="line">	<span class="comment">//解析执行的标签</span></span><br><span class="line">	<span class="keyword">return</span> handler.parse(ele, <span class="keyword">new</span> <span class="title class_">ParserContext</span>(<span class="built_in">this</span>.readerContext, <span class="built_in">this</span>, containingBd));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在执行resovle方法时，就是从Map handlerMappings中根据命名空间名称获得对应的处理器对 象，此处是ContextNamespaceHandler，最终执行NamespaceHandler的parse方法</p>
<p>ContextNamespaceHandler源码如下，间接实现了NamespaceHandler接口，初始化方法init会被自动调用。由于 context命名空间下有多个标签，所以每个标签又单独注册了对应的解析器，注册到了其父类 NamespaceHandlerSupport的Map parsers中去了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextNamespaceHandler</span> <span class="keyword">extends</span> <span class="title class_">NamespaceHandlerSupport</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">ContextNamespaceHandler</span><span class="params">()</span> &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;property-placeholder&quot;</span>, <span class="keyword">new</span> </span><br><span class="line"><span class="title class_">PropertyPlaceholderBeanDefinitionParser</span>());</span><br><span class="line">		<span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;property-override&quot;</span>, <span class="keyword">new</span> <span class="title class_">PropertyOverrideBeanDefinitionParser</span>());</span><br><span class="line">		<span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;annotation-config&quot;</span>, <span class="keyword">new</span> <span class="title class_">AnnotationConfigBeanDefinitionParser</span>());</span><br><span class="line">		<span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;component-scan&quot;</span>, <span class="keyword">new</span> <span class="title class_">ComponentScanBeanDefinitionParser</span>());</span><br><span class="line">		<span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;load-time-weaver&quot;</span>, <span class="keyword">new</span> <span class="title class_">LoadTimeWeaverBeanDefinitionParser</span>());</span><br><span class="line">		<span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;spring-configured&quot;</span>, <span class="keyword">new</span> <span class="title class_">SpringConfiguredBeanDefinitionParser</span>());</span><br><span class="line">		<span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;mbean-export&quot;</span>, <span class="keyword">new</span> <span class="title class_">MBeanExportBeanDefinitionParser</span>());</span><br><span class="line">		<span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;mbean-server&quot;</span>, <span class="keyword">new</span> <span class="title class_">MBeanServerBeanDefinitionParser</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上述分析，我们清楚的了解了外部命名空间标签的执行流程，如下：</p>
<ul>
<li>将自定义标签的约束 与 物理约束文件与网络约束名称的约束 以键值对形式存储到一个spring.schemas文件里 ，该文件存储在类加载路径的 META-INF里，Spring会自动加载到;</li>
<li>将自定义命名空间的名称 与 自定义命名空间的处理器映射关系 以键值对形式存在到一个叫spring.handlers文 件里，该文件存储在类加载路径的 META-INF里，Spring会自动加载到;</li>
<li>准备好NamespaceHandler，如果命名空间只有一个标签，那么直接在parse方法中进行解析即可，一般解析结 果就是注册该标签对应的BeanDefinition。如果命名空间里有多个标签，那么可以在init方法中为每个标签都注 册一个BeanDefinitionParser，在执行NamespaceHandler的parse方法时在分流给不同的 BeanDefinitionParser进行解析(重写doParse方法即可)。</li>
</ul>
<h1 id="基于注解的Spring应用"><a href="#基于注解的Spring应用" class="headerlink" title="基于注解的Spring应用"></a>基于注解的Spring应用</h1><h2 id="Bean基本注解开发"><a href="#Bean基本注解开发" class="headerlink" title="Bean基本注解开发"></a>Bean基本注解开发</h2><p>Spring除了xml配置文件进行配置之外，还可以使用注解方式进行配置，注解方式慢慢成为xml配置的替代方案。我 们有了xml开发的经验，学习注解开发就方便了许多，注解开发更加快捷方便。</p>
<p>Spring提供的注解有三个版本：</p>
<ul>
<li>2.0时代，Spring开始出现注解</li>
<li>2.5时代，Spring的Bean配置可以使用注解完成</li>
<li>3.0时代，Spring其他配置也可以使用注解完成，我们进入全注解时代</li>
</ul>
<p>基本Bean注解，主要是使用注解的方式替代原有xml的<bean> 标签及其标签属性的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">abstract</span>=<span class="string">&quot;&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用@Component 注解替代标签</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>xml配置</th>
<th>注解</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><bean id="" class=""></td>
<td>@Component</td>
<td>被该注解标识的类，会在指定扫描范围内被Spring加载并实例化</td>
</tr>
</tbody>
</table>
</div>
<p>可以通过@Component注解的value属性指定当前Bean实例的beanName，也可以省略不写，不写的情况下为当前 类名首字母小写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取方式：applicationContext.getBean(&quot;userDao&quot;);</span></span><br><span class="line"><span class="meta">@Component(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取方式：applicationContext.getBean(&quot;userDaoImpl&quot;);</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用注解对需要被Spring实例化的Bean进行标注，但是需要告诉Spring去哪找这些Bean，要配置组件扫描路径</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/xmlSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 告知Spring框架去itheima包及其子包下去扫描使用了注解的类 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>@Component就单纯一个value属性，那么xml配置<bean>时那些属性怎么进行配置呢？Spring 是通过注解方 式去配置的之前  标签中的那些属性，例如：@Scope</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>xml配置</th>
<th>xml配置</th>
<th>xml配置</th>
</tr>
</thead>
<tbody>
<tr>
<td><bean scope=""></td>
<td>@Scope</td>
<td>在类上或使用了@Bean标注的方法上，标注Bean的作用范围，取值为 singleton或prototype</td>
</tr>
<tr>
<td><bean lazy-init=""></td>
<td>@Lazy</td>
<td>在类上或使用了@Bean标注的方法上，标注Bean是否延迟加载，取值为 true和false</td>
</tr>
<tr>
<td><bean init-method=""></td>
<td>@PostConstruct</td>
<td>在方法上使用，标注Bean的实例化后执行的方法</td>
</tr>
<tr>
<td><bean destroy-method=""></td>
<td>@PreDestroy</td>
<td>在方法上使用，标注Bean的销毁前执行方法</td>
</tr>
</tbody>
</table>
</div>
<p>使用上述注解完成UserDaoImpl的基本配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;userDao&quot;)</span></span><br><span class="line"><span class="meta">@Scope(&quot;singleton&quot;)</span></span><br><span class="line"><span class="meta">@Lazy(true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">	<span class="meta">@PostConstruct</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">	<span class="meta">@PreDestroy</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于JavaEE开发是分层的，为了每层Bean标识的注解语义化更加明确，@Component又衍生出如下三个注解：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>@Component衍生注解</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Repository</td>
<td>在Dao层类上使用</td>
</tr>
<tr>
<td>@Service</td>
<td>在Service层类上使用</td>
</tr>
<tr>
<td>@Controller</td>
<td>在Web层类上使用</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br><span class="line"><span class="meta">@Service(&quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;&#125;</span><br><span class="line"><span class="meta">@Controller(&quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Bean依赖注入注解开发"><a href="#Bean依赖注入注解开发" class="headerlink" title="Bean依赖注入注解开发"></a>Bean依赖注入注解开发</h2><p>Bean依赖注入的注解，主要是使用注解的方式替代xml的 <property>标签完成属性的注入操作</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Spring主要提供如下注解，用于在Bean内部进行属性注入的：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>属性注入注解</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Value</td>
<td>使用在字段或方法上，用于注入普通数据</td>
</tr>
<tr>
<td>@Autowired</td>
<td>使用在字段或方法上，用于根据类型（byType）注入引用数据</td>
</tr>
<tr>
<td>@Qualifier</td>
<td>使用在字段或方法上，结合@Autowired，根据名称注入</td>
</tr>
<tr>
<td>@Resource</td>
<td>使用在字段或方法上，根据类型或名称进行注入</td>
</tr>
</tbody>
</table>
</div>
<p>通过@Value 直接注入普通属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;haohao&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="meta">@Value(&quot;haohao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span>&#123;</span><br><span class="line">	System.out.println(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过@Value 注入properties文件中的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span>&#123;</span><br><span class="line">	System.out.println(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>加载properties文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>@Autowired注解，用于根据类型进行注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用在属性上直接注入</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="comment">//使用在方法上直接注入</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span>&#123;</span><br><span class="line">	System.out.println(userDao);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当容器中同一类型的Bean实例有多个时，会尝试自动根据名字进行匹配：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//匹配当前Bean</span></span><br><span class="line"><span class="meta">@Repository(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br><span class="line"><span class="meta">@Repository(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl2</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>当容器中同一类型的Bean实例有多个时，且名字与被注入Bean名称不匹配时会报错</p>
<p>@Qualifier配合@Autowired可以完成根据名称注入Bean实例，使用@Qualifier指定名称</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span>&#123;</span><br><span class="line">	System.out.println(userDao);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Resource注解既可以根据类型注入，也可以根据名称注入，无参就是根据类型注入，有参数就是根据名称注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="meta">@Resource(name = &quot;userDao2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span>&#123;</span><br><span class="line">	System.out.println(userDao);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PS：@Resource注解存在与 javax.annotation 包中，Spring对其进行了解析</p>
</blockquote>
<h2 id="非自定义Bean注解开发"><a href="#非自定义Bean注解开发" class="headerlink" title="非自定义Bean注解开发"></a>非自定义Bean注解开发</h2><p>非自定义Bean不能像自定义Bean一样使用@Component进行管理，非自定义Bean要通过工厂的方式进行实例化， 使用@Bean标注方法即可，@Bean的属性为beanName，如不指定为当前工厂方法名称</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将方法返回值Bean实例以@Bean注解指定的名称存储到Spring容器中</span></span><br><span class="line"><span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">	dataSource.setDriverClassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">	dataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>);</span><br><span class="line">	dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">	dataSource.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> dataSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PS：工厂方法所在类必须要被Spring管理</p>
</blockquote>
<p>如果@Bean工厂方法需要参数的话，则有如下几种注入方式：</p>
<ul>
<li>使用@Autowired 根据类型自动进行Bean的匹配，@Autowired可以省略 ；</li>
<li>使用@Qualifier 根据名称进行Bean的匹配；</li>
<li>使用@Value 根据名称进行普通数据类型匹配。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Autowired</span> <span class="comment">//根据类型匹配参数</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">objectDemo01</span><span class="params">(UserDao userDao)</span>&#123;</span><br><span class="line">	System.out.println(userDao);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">objectDemo02</span><span class="params">(<span class="meta">@Qualifier(&quot;userDao&quot;)</span> UserDao userDao,</span></span><br><span class="line"><span class="params"><span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span> String username)</span>&#123;</span><br><span class="line">	System.out.println(userDao);</span><br><span class="line">	System.out.println(username);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Bean配置类的注解开发"><a href="#Bean配置类的注解开发" class="headerlink" title="Bean配置类的注解开发"></a>Bean配置类的注解开发</h2><p>@Component等注解替代了&lt; bean&gt;标签，但是像&lt; import&gt;、  &lt; context:componentScan&gt;等非&lt; bean&gt;标签怎 样去使用注解替代呢？</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载properties文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 组件扫描 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入其他xml文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:beans.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>定义一个配置类替代原有的xml配置文件，&lt; bean&gt;标签以外的标签，一般都是在配置类上使用注解完成的</p>
<p>@Configuration注解标识的类为配置类，替代原有xml配置文件，该注解第一个作用是标识该类是一个配置类，第 二个作用是具备@Component作用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>@ComponentScan 组件扫描配置，替代原有xml文件中的&lt; context:component-scan base-package=””/&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.itheima.service&quot;,&quot;com.itheima.dao&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>@PropertySource 注解用于加载外部properties资源配置，替代原有xml中的 &lt; context:property-placeholder location=“”/&gt; 配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="meta">@PropertySource(&#123;&quot;classpath:jdbc.properties&quot;,&quot;classpath:xxx.properties&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>@Import 用于加载其他配置类，替代原有xml中的&lt; import resource=“classpath:beans.xml”/&gt;配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@Import(OtherConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Spring-配置其他注解"><a href="#Spring-配置其他注解" class="headerlink" title="Spring 配置其他注解"></a>Spring 配置其他注解</h2><p>扩展：@Primary注解用于标注相同类型的Bean优先被使用权，@Primary 是Spring3.0引入的，与@Component 和@Bean一起使用，标注该Bean的优先级更高，则在通过类型获取Bean或通过@Autowired根据类型进行注入时， 会选用优先级更高的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br><span class="line"><span class="meta">@Repository(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl2</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UserDao <span class="title function_">userDao01</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> UserDao <span class="title function_">userDao02</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl2</span>();&#125;</span><br></pre></td></tr></table></figure>
<p>扩展：@Profile 注解的作用同于xml配置时学习profile属性，是进行环境切换使用的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注解 @Profile 标注在类或方法上，标注当前产生的Bean从属于哪个环境，只有激活了当前环境，被标注的Bean才 能被注册到Spring容器里，不指定环境的Bean，任何环境下都能注册到Spring容器里</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;userDao&quot;)</span></span><br><span class="line"><span class="meta">@Profile(&quot;test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br><span class="line"><span class="meta">@Repository(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl2</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>可以使用以下两种方式指定被激活的环境：</p>
<ul>
<li>使用命令行动态参数，虚拟机参数位置加载 -Dspring.profiles.active=test</li>
<li>使用代码的方式设置环境变量 System.setProperty(“spring.profiles.active”,”test”);</li>
</ul>
<h2 id="Spring注解的解析原理"><a href="#Spring注解的解析原理" class="headerlink" title="Spring注解的解析原理"></a>Spring注解的解析原理</h2><p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818200152514.png" alt="image-20240818200152514"></p>
<p>使用@Component等注解配置完毕后，要配置组件扫描才能使注解生效</p>
<ul>
<li>xml配置组件扫描：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>配置类配置组件扫描：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用xml方式配置组件扫描，而component-scan是一个context命名空间下的自定义标签，所以要找到对应的命名 空间处理器NamespaceHandler 和 解析器，查看spring-context包下的spring.handlers文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http\://www.springframework.org/schema/context=org.springframework.context.config.ContextNamespaceHandler</span><br></pre></td></tr></table></figure>
<p>查看 ContextNamespaceHandler 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;component-scan&quot;</span>, <span class="keyword">new</span> </span><br><span class="line"><span class="title class_">ComponentScanBeanDefinitionParser</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将ComponentScanBeanDefinitionParser进行了注册，对其源码进行跟踪，最终将标注的@Component的类，生 成对应的BeanDefiition进行了注册</p>
<p>使用配置类配置组件扫描，使用AnnotationConfigApplicationContext容器在进行创建时，内部调用了如下代码， 该工具注册了几个Bean后处理器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AnnotationConfigUtils.registerAnnotationConfigProcessors(<span class="built_in">this</span>.registry);</span><br></pre></td></tr></table></figure>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818200356441.png" alt="image-20240818200356441"></p>
<p><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/image-20240818200413283.png" alt="image-20240818200413283"></p>
<h2 id="Spring注解方式整合第三方框架"><a href="#Spring注解方式整合第三方框架" class="headerlink" title="Spring注解方式整合第三方框架"></a>Spring注解方式整合第三方框架</h2><p>第三方框架整合，依然使用MyBatis作为整合对象，之前我们已经使用xml方式整合了MyBatis，现在使用注解方式 无非就是将xml标签替换为注解，将xml配置文件替换为配置类而已，原有xml方式整合配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置数据源--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置SqlSessionFactoryBean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置Mapper包扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.itheima.dao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用@Bean将DataSource和SqlSessionFactoryBean存储到Spring容器中，而MapperScannerConfigurer使用注 解@MapperScan进行指明需要扫描的Mapper在哪个包下，使用注解整合MyBatis配置方式如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.itheima.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">		<span class="comment">//省略部分代码</span></span><br><span class="line">		<span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">		<span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">		sqlSessionFactoryBean.setDataSource(dataSource);</span><br><span class="line">		<span class="keyword">return</span> sqlSessionFactoryBean;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注解方式，Spring整合MyBatis的原理，关键在于@MapperScan，@MapperScan不是Spring提供的注解，是 MyBatis为了整合Spring，在整合包org.mybatis.spring.annotation中提供的注解，源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(&#123;MapperScannerRegistrar.class&#125;)</span></span><br><span class="line"><span class="meta">@Repeatable(MapperScans.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MapperScan &#123;</span><br><span class="line">	String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">	String[] basePackages() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">	Class&lt;?&gt;[] basePackageClasses() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">	Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationClass() <span class="keyword">default</span> Annotation.class;</span><br><span class="line">	<span class="comment">// ... ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MapperScannerRegistrar实现了ImportBeanDefinitionRegistrar接口，Spring会自动调用 registerBeanDefinitions方法，该方法中又注册MapperScannerConfigurer类，而MapperScannerConfigurer类 作用是扫描Mapper，向容器中注册Mapper对应的MapperFactoryBean，前面讲过，此处不在赘述了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperScannerRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span>, </span><br><span class="line">ResourceLoaderAware &#123;</span><br><span class="line">	<span class="comment">//默认执行registerBeanDefinitions方法</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata annoMeta, AnnotationAttributes annoAttrs, BeanDefinitionRegistry registry, String beanName)</span> &#123;</span><br><span class="line">		<span class="type">BeanDefinitionBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> </span><br><span class="line">BeanDefinitionBuilder.genericBeanDefinition(MapperScannerConfigurer.class);</span><br><span class="line">		<span class="comment">//... 省略其他代码 ...</span></span><br><span class="line">		<span class="comment">//注册BeanDefinition</span></span><br><span class="line">		registry.registerBeanDefinition(beanName, builder.getBeanDefinition());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring与MyBatis注解方式整合有个重要的技术点就是@Import，第三方框架与Spring整合xml方式很多是凭借自 定义标签完成的，而第三方框架与Spring整合注解方式很多是靠@Import注解完成的。</p>
<p>@Import可以导入如下三种类：</p>
<ul>
<li>普通的配置类</li>
<li>实现ImportSelector接口的类</li>
<li>实现ImportBeanDefinitionRegistrar接口的类</li>
</ul>
<p>@Import导入实现了ImportSelector接口的类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;MyImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">		<span class="comment">//返回要进行注册的Bean的全限定名数组</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;User2.class.getName()&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ImportSelector接口selectImports方法的参数AnnotationMetadata代表注解的媒体数据，可以获得当前注解修饰 的类的元信息，例如：获得组件扫描的包名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">		<span class="comment">//获得指定类型注解的全部信息</span></span><br><span class="line">		Map&lt;String, Object&gt; annotationAttributes = </span><br><span class="line">annotationMetadata.getAnnotationAttributes(ComponentScan.class.getName());</span><br><span class="line">		<span class="comment">//获得全部信息中basePackages信息</span></span><br><span class="line">		String[] basePackages = (String[]) annotationAttributes.get(<span class="string">&quot;basePackages&quot;</span>);</span><br><span class="line">		<span class="comment">//打印结果是com.itheima</span></span><br><span class="line">		System.out.println(basePackages[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;User2.class.getName()&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Import导入实现ImportBeanDefinitionRegistrar接口的类，实现了该接口的类的registerBeanDefinitions方法 会被自动调用，在该方法内可以注册BeanDefinition</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, </span></span><br><span class="line"><span class="params">BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">		<span class="comment">//使用给定的BeanDefinitionRegistry参数，手动注册BeanDefinition</span></span><br><span class="line">		<span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">		beanDefinition.setBeanClassName(<span class="string">&quot;com.itheima.pojo.User2&quot;</span>);</span><br><span class="line">		registry.registerBeanDefinition(<span class="string">&quot;user2&quot;</span>,beanDefinition);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">JLY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/posts/6c92115f.html">http://example.com/posts/6c92115f.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">JLY的小窝</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring/">Spring</a><a class="post-meta__tags" href="/tags/IOC/">IOC</a><a class="post-meta__tags" href="/tags/DI/">DI</a></div><div class="post_share"><div class="social-share" data-image="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/51f1d6a7e90c510ac74f0089bcd6c805.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/69c3279c.html" title="Git"><img class="cover" src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/b8569accbc346130a3fc21c58b1899e3.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Git</div></div></a></div><div class="next-post pull-right"><a href="/posts/655d86b3.html" title="Spring AOP"><img class="cover" src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/1e116798c6081a44ef476551aeddd850.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Spring AOP</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/655d86b3.html" title="Spring AOP"><img class="cover" src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/1e116798c6081a44ef476551aeddd850.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-20</div><div class="title">Spring AOP</div></div></a></div><div><a href="/posts/73f99711.html" title="Spring MVC"><img class="cover" src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/1e116798c6081a44ef476551aeddd850.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-20</div><div class="title">Spring MVC</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">JLY</div><div class="author-info__description">这是一个分享美好事物的地方。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">40</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/jialuyu1102"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/jialuyu1102" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:jialuyu1102@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">2024/08/04, JLY的小站成立啦!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9FJavaweb%E5%BC%80%E5%8F%91%E7%9A%84%E5%9B%B0%E6%83%91"><span class="toc-number">1.</span> <span class="toc-text">传统Javaweb开发的困惑</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IOC%E3%80%81DI%E3%80%81AOP%E6%80%9D%E6%83%B3%E6%8F%90%E5%87%BA"><span class="toc-number">2.</span> <span class="toc-text">IOC、DI、AOP思想提出</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IOC%E3%80%81DI%E6%80%9D%E6%83%B3%E6%8F%90%E5%87%BA"><span class="toc-number">2.1.</span> <span class="toc-text">IOC、DI思想提出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP-%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E6%80%9D%E6%83%B3%E6%8F%90%E5%87%BA"><span class="toc-number">2.2.</span> <span class="toc-text">AOP 面向切面思想提出</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring%E6%A1%86%E6%9E%B6%E7%9A%84%E8%AF%9E%E7%94%9F"><span class="toc-number">3.</span> <span class="toc-text">Spring框架的诞生</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">Spring 框架概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E6%A1%86%E6%9E%B6%E7%9A%84%E5%8E%86%E5%8F%B2"><span class="toc-number">3.2.</span> <span class="toc-text">Spring 框架的历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Framework%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">3.3.</span> <span class="toc-text">Spring Framework技术栈</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BeanFactory-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">4.</span> <span class="toc-text">BeanFactory 快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#BeanFactory-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8-1"><span class="toc-number">4.1.</span> <span class="toc-text">BeanFactory 快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5Spring%E4%BE%9D%E8%B5%96"><span class="toc-number">4.1.1.</span> <span class="toc-text">导入Spring依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0IOC"><span class="toc-number">4.1.2.</span> <span class="toc-text">实现IOC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0DI"><span class="toc-number">4.1.3.</span> <span class="toc-text">实现DI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ApplicationContext%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">4.2.</span> <span class="toc-text">ApplicationContext快速入门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BeanFactory%E4%B8%8EApplicationContext%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">4.3.</span> <span class="toc-text">BeanFactory与ApplicationContext的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BeanFactory%E7%9A%84%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB"><span class="toc-number">4.4.</span> <span class="toc-text">BeanFactory的继承体系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ApplicationContext%E7%9A%84%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB"><span class="toc-number">4.5.</span> <span class="toc-text">ApplicationContext的继承体系</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Exml%E7%9A%84Spring%E5%BA%94%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">基于xml的Spring应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBean-%E7%9A%84%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3"><span class="toc-number">5.1.</span> <span class="toc-text">SpringBean 的配置详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.1.</span> <span class="toc-text">Bean的基础配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E5%88%AB%E5%90%8D%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.2.</span> <span class="toc-text">Bean的别名配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E8%8C%83%E5%9B%B4%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.3.</span> <span class="toc-text">Bean的范围配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">5.1.4.</span> <span class="toc-text">Bean的延迟加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E9%94%80%E6%AF%81%E6%96%B9%E6%B3%95%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.5.</span> <span class="toc-text">Bean的初始化和销毁方法配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.6.</span> <span class="toc-text">Bean的实例化配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E5%AE%9E%E4%BE%8B%E5%8C%96Bean"><span class="toc-number">5.1.6.1.</span> <span class="toc-text">静态工厂方法实例化Bean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95"><span class="toc-number">5.1.6.2.</span> <span class="toc-text">实例工厂方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FactoryBean%E8%A7%84%E8%8C%83%E5%BB%B6%E8%BF%9F%E5%AE%9E%E4%BE%8B%E5%8C%96Bean"><span class="toc-number">5.1.6.3.</span> <span class="toc-text">FactoryBean规范延迟实例化Bean</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.7.</span> <span class="toc-text">Bean的依赖注入配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring%E7%9A%84%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE%E6%A0%87%E7%AD%BE"><span class="toc-number">5.1.8.</span> <span class="toc-text">Spring的其他配置标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E7%9A%84get%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.</span> <span class="toc-text">Spring 的get方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E9%85%8D%E7%BD%AE%E9%9D%9E%E8%87%AA%E5%AE%9A%E4%B9%89Bean"><span class="toc-number">5.3.</span> <span class="toc-text">Spring 配置非自定义Bean</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Druid-%E6%95%B0%E6%8D%AE%E6%BA%90%E4%BA%A4%E7%94%B1Spring%E7%AE%A1%E7%90%86"><span class="toc-number">5.3.1.</span> <span class="toc-text">配置 Druid 数据源交由Spring管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEConnection%E4%BA%A4%E7%94%B1Spring%E7%AE%A1%E7%90%86"><span class="toc-number">5.3.2.</span> <span class="toc-text">配置Connection交由Spring管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1%E4%BA%A4%E7%94%B1Spring%E7%AE%A1%E7%90%86"><span class="toc-number">5.3.3.</span> <span class="toc-text">配置日期对象交由Spring管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEMyBatis%E7%9A%84SqlSessionFactory%E4%BA%A4%E7%94%B1Spring%E7%AE%A1%E7%90%86"><span class="toc-number">5.3.4.</span> <span class="toc-text">配置MyBatis的SqlSessionFactory交由Spring管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean-%E5%AE%9E%E4%BE%8B%E5%8C%96%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="toc-number">5.4.</span> <span class="toc-text">Bean 实例化的基本流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E7%9A%84%E5%90%8E%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">5.5.</span> <span class="toc-text">Spring的后处理器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">5.6.</span> <span class="toc-text">Spring Bean的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7%E5%A1%AB%E5%85%85"><span class="toc-number">5.6.1.</span> <span class="toc-text">Bean实例属性填充</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96"><span class="toc-number">5.6.1.1.</span> <span class="toc-text">循环依赖</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84Aware%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.6.2.</span> <span class="toc-text">常用的Aware接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-IoC-%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93"><span class="toc-number">5.6.3.</span> <span class="toc-text">Spring IoC 整体流程总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-xml%E6%96%B9%E5%BC%8F%E6%95%B4%E5%90%88%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6"><span class="toc-number">5.7.</span> <span class="toc-text">Spring xml方式整合第三方框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E5%90%88Mybatis"><span class="toc-number">5.7.1.</span> <span class="toc-text">整合Mybatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F"><span class="toc-number">5.7.2.</span> <span class="toc-text">命名空间扩展方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84Spring%E5%BA%94%E7%94%A8"><span class="toc-number">6.</span> <span class="toc-text">基于注解的Spring应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean%E5%9F%BA%E6%9C%AC%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-number">6.1.</span> <span class="toc-text">Bean基本注解开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-number">6.2.</span> <span class="toc-text">Bean依赖注入注解开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E8%87%AA%E5%AE%9A%E4%B9%89Bean%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-number">6.3.</span> <span class="toc-text">非自定义Bean注解开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean%E9%85%8D%E7%BD%AE%E7%B1%BB%E7%9A%84%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-number">6.4.</span> <span class="toc-text">Bean配置类的注解开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E9%85%8D%E7%BD%AE%E5%85%B6%E4%BB%96%E6%B3%A8%E8%A7%A3"><span class="toc-number">6.5.</span> <span class="toc-text">Spring 配置其他注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E6%B3%A8%E8%A7%A3%E7%9A%84%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86"><span class="toc-number">6.6.</span> <span class="toc-text">Spring注解的解析原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F%E6%95%B4%E5%90%88%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6"><span class="toc-number">6.7.</span> <span class="toc-text">Spring注解方式整合第三方框架</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/73f99711.html" title="Spring MVC"><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/1e116798c6081a44ef476551aeddd850.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring MVC"/></a><div class="content"><a class="title" href="/posts/73f99711.html" title="Spring MVC">Spring MVC</a><time datetime="2024-08-19T23:56:08.000Z" title="发表于 2024-08-20 07:56:08">2024-08-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/655d86b3.html" title="Spring AOP"><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/1e116798c6081a44ef476551aeddd850.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring AOP"/></a><div class="content"><a class="title" href="/posts/655d86b3.html" title="Spring AOP">Spring AOP</a><time datetime="2024-08-19T23:54:49.000Z" title="发表于 2024-08-20 07:54:49">2024-08-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6c92115f.html" title="Spring"><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/51f1d6a7e90c510ac74f0089bcd6c805.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring"/></a><div class="content"><a class="title" href="/posts/6c92115f.html" title="Spring">Spring</a><time datetime="2024-08-19T15:26:37.000Z" title="发表于 2024-08-19 23:26:37">2024-08-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/69c3279c.html" title="Git"><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/b8569accbc346130a3fc21c58b1899e3.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git"/></a><div class="content"><a class="title" href="/posts/69c3279c.html" title="Git">Git</a><time datetime="2024-08-14T12:58:07.000Z" title="发表于 2024-08-14 20:58:07">2024-08-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/be4eff35.html" title="Filter &amp;&amp; Listener"><img src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/851c3561c4e8ae210cd56008835c79a6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Filter &amp;&amp; Listener"/></a><div class="content"><a class="title" href="/posts/be4eff35.html" title="Filter &amp;&amp; Listener">Filter &amp;&amp; Listener</a><time datetime="2024-08-14T11:54:05.000Z" title="发表于 2024-08-14 19:54:05">2024-08-14</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2024 By JLY</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.22.1/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.65.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 190px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 160px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(https://npm.elemecdn.com/akilar-candyassets/image/cover1.webp);"> <a class="categoryBar-list-link" href="categories/Java技术栈/">Java技术栈</a><span class="categoryBar-list-count">19</span><span class="categoryBar-list-descr">学习笔记1</span></li><li class="categoryBar-list-item" style="background:url(https://npm.elemecdn.com/akilar-candyassets/image/cover2.webp);"> <a class="categoryBar-list-link" href="categories/学习笔记2/">学习笔记2</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">学习笔记2</span></li><li class="categoryBar-list-item" style="background:url(https://npm.elemecdn.com/akilar-candyassets/image/cover3.webp);"> <a class="categoryBar-list-link" href="categories/学习笔记1/">学习笔记1</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">学习笔记3</span></li><li class="categoryBar-list-item" style="background:url(undefined);"> <a class="categoryBar-list-link" href="categories/学习笔记3/">学习笔记3</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/4a17b156.html" alt=""><img width="48" height="48" src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/778479702dde2d807d711d0623445876.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-04</span><a class="blog-slider__title" href="posts/4a17b156.html" alt="">Hello World</a><div class="blog-slider__text">hello-world</div><a class="blog-slider__button" href="posts/4a17b156.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/f965df95.html" alt=""><img width="48" height="48" src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/1d9aca4b980f1f73b8e0e83affa95fa1.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-05</span><a class="blog-slider__title" href="posts/f965df95.html" alt="">moudle</a><div class="blog-slider__text">文章模板</div><a class="blog-slider__button" href="posts/f965df95.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/8ed2565f.html" alt=""><img width="48" height="48" src="https://yu-1312265541.cos.ap-nanjing.myqcloud.com/imgs/b589de7e6467d847e8eeae9a92c932bd.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-04</span><a class="blog-slider__title" href="posts/8ed2565f.html" alt="">newPost</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="posts/8ed2565f.html" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>